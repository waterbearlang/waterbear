function Timer(){this.time=0,this.start_time=Date.now(),this.update_time()}function Local(){this.shape=null,this.shape_references={},this.array_references={},this.object_references={},this.function_references={},this.regex_references={},this.string_references={},this.last_var=null,this.variables={}}function Global(){this.timer=new Timer,this.keys={},this.stage=document.getElementsByClassName("stage")[0],this.mouse_x=-1,this.mouse_y=-1,this.stage_width=this.stage.clientWidth,this.stage_height=this.stage.clientHeight,this.stage_center_x=this.stage_width/2,this.stage_center_y=this.stage_height/2,this.mouse_down=!1,this.subscribeMouseEvents(),this.subscribeKeyboardEvents()}function rad2deg(rad){return rad/DEGREE}function deg2rad(deg){return deg*DEGREE}function range(start,end,step){var rg=[];void 0===end&&(end=start,start=0),void 0===step&&(step=1);var i,val;for(len=end-start,i=0;len>i&&(val=i*step+start,!(val>end-1));i++)rg.push(val);return rg}function randint(start,stop){void 0===stop&&(stop=start,start=0);var factor=stop-start+1;return Math.floor(Math.random()*factor)+start}function angle(shape){var tform=shape.rotate();return 0===tform?tform:parseInt(tform.split(/\s+/)[0],10)}function RectSprite(size,pos,color){this.x=pos.x,this.y=pos.y,this.w=size.w,this.h=size.h,this.collisionRect=this,this.color=color}function Vector2(dx,dy){this.dx=dx||0,this.dy=dy||0}Timer.prototype.update_time=function(){var self=this;this.time=Math.round(Date.now()-this.start_time),setTimeout(function(){self.update_time()},1e3)},Timer.prototype.reset=function(){this.start_time=Date.now(),this.time=0},Timer.prototype.value=function(){return this.time},Local.prototype.set=function(type,name,value){return void 0===this[type]&&(this[type]={}),void 0!==this[type][name]&&console.warn("Overwriting %s named %s",type,name),this[type][name]=value,this.last_var=value,this},Local.prototype.get=function(type,name){return void 0===this[type]?(console.error("Cannot remove %s from unknown type %s",name,type),void 0):void 0===this[type][name]?(console.error("No %s named %s to remove",type,name),void 0):this[type][name]},Local.prototype.delete=function(type,name){if(void 0===this[type])return console.error("Cannot remove %s from unknown type %s",name,type),void 0;if(void 0===this[type][name])return console.error("No %s named %s to remove",type,name),void 0;var value=this[type][name];return delete this[type][name],value},Global.prototype.subscribeMouseEvents=function(){var self=this;this.stage.addEventListener("mousedown",function(){self.mouse_down=!0}),this.stage.addEventListener("mousemove",function(evt){self.mouse_x=evt.offsetX,self.mouse_y=evt.offsetY}),document.body.addEventListener("mouseup",function(){self.mouse_down=!1})},Global.prototype.specialKeys={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},Global.prototype.shiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},Global.prototype.keyForEvent=function(evt){return this.specialKeys[evt.keyCode]?this.specialKeys[evt.keyCode]:String.fromCharCode(evt.which).toLowerCase()},Global.prototype.isKeyDown=function(key){return this.keys[key]},Global.prototype.subscribeKeyboardEvents=function(){var self=this;document.body.addEventListener("keydown",function(evt){self.keys[self.keyForEvent(evt)]=!0}),document.body.addEventListener("keyup",function(evt){self.keys[self.keyForEvent(evt)]=!1})};var DEGREE=Math.PI/180;if(window.debug=!1,twinapex={},twinapex.debug={},twinapex.debug.printException=function(exc){function prints(msg){console.log(msg)}if(prints(exc),!exc.stack)return prints("no stacktrace available"),void 0;for(var lines=exc.stack.toString().split("\n"),toprint=[],i=0;i<lines.length;i++){var line=lines[i];if(line.indexOf("ecmaunit.js")>-1)break;"("==line.charAt(0)&&(line="function"+line);var chunks=line.split("@");toprint.push(chunks)}toprint.reverse();for(var i=0;i<toprint.length;i++)prints("  "+toprint[i][1]),prints("    "+toprint[i][0]);prints()},twinapex.debug.manageExceptions=function(func){var orignal=func;return decorated=function(){try{orignal.apply(this,arguments)}catch(exception){throw twinapex.debug.printException(exception),exception}}},"undefined"==typeof console){var console={};console.log=function(){},console.info=function(){},console.warn=function(){}}window.RectSprite=RectSprite,RectSprite.prototype.draw=function(ctx){ctx.save(),ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.w,this.h),ctx.restore()},RectSprite.prototype.collides=function(sprite){var self=this.collisionRect,that=sprite.collisionRect;return self.x+self.w<that.x?!1:self.y+self.h<that.y?!1:self.x>that.x+that.w?!1:self.y>that.y+that.h?!1:!0},RectSprite.prototype.toString=function(){return"<RectSprite "+this.x+" "+this.y+" "+this.w+" "+this.h+" "+this.color+">"},Vector2.fromAngle=function(radians,magnitude){return 0>=magnitude&&(magnitude=1),new Vector(Math.cos(radians)*magnitude,Math.sin(radians)*magnitude)},Vector2.prototype.magnitude=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)},Vector2.prototype.add=function(v){return new Vector2(this.dx+v.dx,this.dy+v.dy)},Vector2.prototype.subtract=function(v){return new Vector2(this.dx-v.dx,this.dy-v.dy)},Vector2.prototype.reflect=function(rx,ry){return new Vector2(rx?-this.dx:this.dx,ry?-this.dy:this.dy)},Vector2.prototype.angle=function(){return Math.atan2(this.dy,this.dx)},Vector2.prototype.rotate=function(radians){var mag=this.magnitude(),theta=this.angle();return Vector.fromAngle(theta+radians,mag)};