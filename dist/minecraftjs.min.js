function js_beautify(js_source_text,options){function trim_output(eat_newlines){for(eat_newlines="undefined"==typeof eat_newlines?!1:eat_newlines;output.length&&(" "===output[output.length-1]||output[output.length-1]===indent_string||output[output.length-1]===preindent_string||eat_newlines&&("\n"===output[output.length-1]||"\r"===output[output.length-1]));)output.pop()}function trim(s){return s.replace(/^\s\s*|\s\s*$/,"")}function force_newline(){var old_keep_array_indentation=opt_keep_array_indentation;opt_keep_array_indentation=!1,print_newline(),opt_keep_array_indentation=old_keep_array_indentation}function print_newline(ignore_repeated){if(flags.eat_next_space=!1,(!opt_keep_array_indentation||!is_array(flags.mode))&&(ignore_repeated="undefined"==typeof ignore_repeated?!0:ignore_repeated,flags.if_line=!1,trim_output(),output.length)){"\n"===output[output.length-1]&&ignore_repeated||(just_added_newline=!0,output.push("\n")),preindent_string&&output.push(preindent_string);for(var i=0;i<flags.indentation_level;i+=1)output.push(indent_string);flags.var_line&&flags.var_line_reindented&&(" "===opt_indent_char?output.push("    "):output.push(indent_string))}}function print_single_space(){if(flags.eat_next_space)return flags.eat_next_space=!1,void 0;var last_output=" ";output.length&&(last_output=output[output.length-1])," "!==last_output&&"\n"!==last_output&&last_output!==indent_string&&output.push(" ")}function print_token(){just_added_newline=!1,flags.eat_next_space=!1,output.push(token_text)}function indent(){flags.indentation_level+=1}function remove_indent(){output.length&&output[output.length-1]===indent_string&&output.pop()}function set_mode(mode){flags&&flag_store.push(flags),flags={previous_mode:flags?flags.mode:"BLOCK",mode:mode,var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,if_line:!1,in_case:!1,eat_next_space:!1,indentation_baseline:-1,indentation_level:flags?flags.indentation_level+(flags.var_line&&flags.var_line_reindented?1:0):0,ternary_depth:0}}function is_array(mode){return"[EXPRESSION]"===mode||"[INDENTED-EXPRESSION]"===mode}function is_expression(mode){return"[EXPRESSION]"===mode||"[INDENTED-EXPRESSION]"===mode||"(EXPRESSION)"===mode}function restore_mode(){do_block_just_closed="DO_BLOCK"===flags.mode,flag_store.length>0&&(flags=flag_store.pop())}function all_lines_start_with(lines,c){for(var i=0;i<lines.length;i++)if(trim(lines[i])[0]!=c)return!1;return!0}function in_array(what,arr){for(var i=0;i<arr.length;i+=1)if(arr[i]===what)return!0;return!1}function get_next_token(){if(n_newlines=0,parser_pos>=input_length)return["","TK_EOF"];wanted_newline=!1;var c=input.charAt(parser_pos);parser_pos+=1;var keep_whitespace=opt_keep_array_indentation&&is_array(flags.mode);if(keep_whitespace){for(var whitespace_count=0;in_array(c,whitespace);){if("\n"===c?(trim_output(),output.push("\n"),just_added_newline=!0,whitespace_count=0):"	"===c?whitespace_count+=4:"\r"===c||(whitespace_count+=1),parser_pos>=input_length)return["","TK_EOF"];c=input.charAt(parser_pos),parser_pos+=1}if(-1===flags.indentation_baseline&&(flags.indentation_baseline=whitespace_count),just_added_newline){var i;for(i=0;i<flags.indentation_level+1;i+=1)output.push(indent_string);if(-1!==flags.indentation_baseline)for(i=0;i<whitespace_count-flags.indentation_baseline;i++)output.push(" ")}}else{for(;in_array(c,whitespace);){if("\n"===c&&(n_newlines+=opt_max_preserve_newlines?opt_max_preserve_newlines>=n_newlines?1:0:1),parser_pos>=input_length)return["","TK_EOF"];c=input.charAt(parser_pos),parser_pos+=1}if(opt_preserve_newlines&&n_newlines>1)for(i=0;n_newlines>i;i+=1)print_newline(0===i),just_added_newline=!0;wanted_newline=n_newlines>0}if(in_array(c,wordchar)){if(input_length>parser_pos)for(;in_array(input.charAt(parser_pos),wordchar)&&(c+=input.charAt(parser_pos),parser_pos+=1,parser_pos!==input_length););if(parser_pos!==input_length&&c.match(/^[0-9]+[Ee]$/)&&("-"===input.charAt(parser_pos)||"+"===input.charAt(parser_pos))){var sign=input.charAt(parser_pos);parser_pos+=1;var t=get_next_token(parser_pos);return c+=sign+t[0],[c,"TK_WORD"]}return"in"===c?[c,"TK_OPERATOR"]:(!wanted_newline||"TK_OPERATOR"===last_type||"TK_EQUALS"===last_type||flags.if_line||!opt_preserve_newlines&&"var"===last_text||print_newline(),[c,"TK_WORD"])}if("("===c||"["===c)return[c,"TK_START_EXPR"];if(")"===c||"]"===c)return[c,"TK_END_EXPR"];if("{"===c)return[c,"TK_START_BLOCK"];if("}"===c)return[c,"TK_END_BLOCK"];if(";"===c)return[c,"TK_SEMICOLON"];if("/"===c){var comment="",inline_comment=!0;if("*"===input.charAt(parser_pos)){if(parser_pos+=1,input_length>parser_pos)for(;("*"!==input.charAt(parser_pos)||!input.charAt(parser_pos+1)||"/"!==input.charAt(parser_pos+1))&&input_length>parser_pos&&(c=input.charAt(parser_pos),comment+=c,("\r"===c||"\n"===c)&&(inline_comment=!1),parser_pos+=1,!(parser_pos>=input_length)););return parser_pos+=2,inline_comment?["/*"+comment+"*/","TK_INLINE_COMMENT"]:["/*"+comment+"*/","TK_BLOCK_COMMENT"]}if("/"===input.charAt(parser_pos)){for(comment=c;"\r"!==input.charAt(parser_pos)&&"\n"!==input.charAt(parser_pos)&&(comment+=input.charAt(parser_pos),parser_pos+=1,!(parser_pos>=input_length)););return parser_pos+=1,wanted_newline&&print_newline(),[comment,"TK_COMMENT"]}}if("'"===c||'"'===c||"/"===c&&("TK_WORD"===last_type&&in_array(last_text,["return","do"])||"TK_COMMENT"===last_type||"TK_START_EXPR"===last_type||"TK_START_BLOCK"===last_type||"TK_END_BLOCK"===last_type||"TK_OPERATOR"===last_type||"TK_EQUALS"===last_type||"TK_EOF"===last_type||"TK_SEMICOLON"===last_type)){var sep=c,esc=!1,resulting_string=c;if(input_length>parser_pos)if("/"===sep){for(var in_char_class=!1;esc||in_char_class||input.charAt(parser_pos)!==sep;)if(resulting_string+=input.charAt(parser_pos),esc?esc=!1:(esc="\\"===input.charAt(parser_pos),"["===input.charAt(parser_pos)?in_char_class=!0:"]"===input.charAt(parser_pos)&&(in_char_class=!1)),parser_pos+=1,parser_pos>=input_length)return[resulting_string,"TK_STRING"]}else for(;esc||input.charAt(parser_pos)!==sep;)if(resulting_string+=input.charAt(parser_pos),esc=esc?!1:"\\"===input.charAt(parser_pos),parser_pos+=1,parser_pos>=input_length)return[resulting_string,"TK_STRING"];if(parser_pos+=1,resulting_string+=sep,"/"===sep)for(;input_length>parser_pos&&in_array(input.charAt(parser_pos),wordchar);)resulting_string+=input.charAt(parser_pos),parser_pos+=1;return[resulting_string,"TK_STRING"]}if("#"===c){if(0===output.length&&"!"===input.charAt(parser_pos)){for(resulting_string=c;input_length>parser_pos&&"\n"!=c;)c=input.charAt(parser_pos),resulting_string+=c,parser_pos+=1;return output.push(trim(resulting_string)+"\n"),print_newline(),get_next_token()}var sharp="#";if(input_length>parser_pos&&in_array(input.charAt(parser_pos),digits)){do c=input.charAt(parser_pos),sharp+=c,parser_pos+=1;while(input_length>parser_pos&&"#"!==c&&"="!==c);return"#"===c||("["===input.charAt(parser_pos)&&"]"===input.charAt(parser_pos+1)?(sharp+="[]",parser_pos+=2):"{"===input.charAt(parser_pos)&&"}"===input.charAt(parser_pos+1)&&(sharp+="{}",parser_pos+=2)),[sharp,"TK_WORD"]}}if("<"===c&&"<!--"===input.substring(parser_pos-1,parser_pos+3))return parser_pos+=3,flags.in_html_comment=!0,["<!--","TK_COMMENT"];if("-"===c&&flags.in_html_comment&&"-->"===input.substring(parser_pos-1,parser_pos+2))return flags.in_html_comment=!1,parser_pos+=2,wanted_newline&&print_newline(),["-->","TK_COMMENT"];if(in_array(c,punct)){for(;input_length>parser_pos&&in_array(c+input.charAt(parser_pos),punct)&&(c+=input.charAt(parser_pos),parser_pos+=1,!(parser_pos>=input_length)););return"="===c?[c,"TK_EQUALS"]:[c,"TK_OPERATOR"]}return[c,"TK_UNKNOWN"]}var input,output,token_text,last_type,last_text,last_last_text,last_word,flags,flag_store,indent_string,whitespace,wordchar,punct,parser_pos,line_starters,digits,prefix,token_type,do_block_just_closed,wanted_newline,just_added_newline,n_newlines,preindent_string="";options=options?options:{};var opt_brace_style;void 0!==options.space_after_anon_function&&void 0===options.jslint_happy&&(options.jslint_happy=options.space_after_anon_function),void 0!==options.braces_on_own_line&&(opt_brace_style=options.braces_on_own_line?"expand":"collapse"),opt_brace_style=options.brace_style?options.brace_style:opt_brace_style?opt_brace_style:"collapse";var opt_indent_size=options.indent_size?options.indent_size:4,opt_indent_char=options.indent_char?options.indent_char:" ",opt_preserve_newlines="undefined"==typeof options.preserve_newlines?!0:options.preserve_newlines,opt_max_preserve_newlines="undefined"==typeof options.max_preserve_newlines?!1:options.max_preserve_newlines,opt_jslint_happy="undefined"===options.jslint_happy?!1:options.jslint_happy,opt_keep_array_indentation="undefined"==typeof options.keep_array_indentation?!1:options.keep_array_indentation;just_added_newline=!1;var input_length=js_source_text.length;for(indent_string="";opt_indent_size>0;)indent_string+=opt_indent_char,opt_indent_size-=1;for(;js_source_text&&(" "===js_source_text[0]||"	"===js_source_text[0]);)preindent_string+=js_source_text[0],js_source_text=js_source_text.substring(1);for(input=js_source_text,last_word="",last_type="TK_START_EXPR",last_text="",last_last_text="",output=[],do_block_just_closed=!1,whitespace="\n\r	 ".split(""),wordchar="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),digits="0123456789".split(""),punct="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::".split(" "),line_starters="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),flag_store=[],set_mode("BLOCK"),parser_pos=0;;){var t=get_next_token(parser_pos);if(token_text=t[0],token_type=t[1],"TK_EOF"===token_type)break;switch(token_type){case"TK_START_EXPR":if("["===token_text){if("TK_WORD"===last_type||")"===last_text){in_array(last_text,line_starters)&&print_single_space(),set_mode("(EXPRESSION)"),print_token();break}"[EXPRESSION]"===flags.mode||"[INDENTED-EXPRESSION]"===flags.mode?"]"===last_last_text&&","===last_text?("[EXPRESSION]"===flags.mode&&(flags.mode="[INDENTED-EXPRESSION]",opt_keep_array_indentation||indent()),set_mode("[EXPRESSION]"),opt_keep_array_indentation||print_newline()):"["===last_text?("[EXPRESSION]"===flags.mode&&(flags.mode="[INDENTED-EXPRESSION]",opt_keep_array_indentation||indent()),set_mode("[EXPRESSION]"),opt_keep_array_indentation||print_newline()):set_mode("[EXPRESSION]"):set_mode("[EXPRESSION]")}else set_mode("(EXPRESSION)");";"===last_text||"TK_START_BLOCK"===last_type?print_newline():"TK_END_EXPR"===last_type||"TK_START_EXPR"===last_type||"TK_END_BLOCK"===last_type||"."===last_text||("TK_WORD"!==last_type&&"TK_OPERATOR"!==last_type?print_single_space():"function"===last_word||"typeof"===last_word?opt_jslint_happy&&print_single_space():(in_array(last_text,line_starters)||"catch"===last_text)&&print_single_space()),print_token();break;case"TK_END_EXPR":if("]"===token_text)if(opt_keep_array_indentation){if("}"===last_text){remove_indent(),print_token(),restore_mode();break}}else if("[INDENTED-EXPRESSION]"===flags.mode&&"]"===last_text){restore_mode(),print_newline(),print_token();break}restore_mode(),print_token();break;case"TK_START_BLOCK":"do"===last_word?set_mode("DO_BLOCK"):set_mode("BLOCK"),"expand"==opt_brace_style?("TK_OPERATOR"!==last_type&&("return"===last_text||"="===last_text?print_single_space():print_newline(!0)),print_token(),indent()):("TK_OPERATOR"!==last_type&&"TK_START_EXPR"!==last_type?"TK_START_BLOCK"===last_type?print_newline():print_single_space():is_array(flags.previous_mode)&&","===last_text&&("}"===last_last_text?print_single_space():print_newline()),indent(),print_token());break;case"TK_END_BLOCK":restore_mode(),"expand"==opt_brace_style?("{"!==last_text&&print_newline(),print_token()):("TK_START_BLOCK"===last_type?just_added_newline?remove_indent():trim_output():is_array(flags.mode)&&opt_keep_array_indentation?(opt_keep_array_indentation=!1,print_newline(),opt_keep_array_indentation=!0):print_newline(),print_token());break;case"TK_WORD":if(do_block_just_closed){print_single_space(),print_token(),print_single_space(),do_block_just_closed=!1;break}if("function"===token_text&&(flags.var_line&&(flags.var_line_reindented=!0),(just_added_newline||";"===last_text)&&"{"!==last_text)){n_newlines=just_added_newline?n_newlines:0,opt_preserve_newlines||(n_newlines=1);for(var i=0;2-n_newlines>i;i++)print_newline(!1)}if("case"===token_text||"default"===token_text){":"===last_text?remove_indent():(flags.indentation_level--,print_newline(),flags.indentation_level++),print_token(),flags.in_case=!0;break}prefix="NONE","TK_END_BLOCK"===last_type?in_array(token_text.toLowerCase(),["else","catch","finally"])?"expand"==opt_brace_style||"end-expand"==opt_brace_style?prefix="NEWLINE":(prefix="SPACE",print_single_space()):prefix="NEWLINE":"TK_SEMICOLON"!==last_type||"BLOCK"!==flags.mode&&"DO_BLOCK"!==flags.mode?"TK_SEMICOLON"===last_type&&is_expression(flags.mode)?prefix="SPACE":"TK_STRING"===last_type?prefix="NEWLINE":"TK_WORD"===last_type?("else"===last_text&&trim_output(!0),prefix="SPACE"):"TK_START_BLOCK"===last_type?prefix="NEWLINE":"TK_END_EXPR"===last_type&&(print_single_space(),prefix="NEWLINE"):prefix="NEWLINE",in_array(token_text,line_starters)&&")"!==last_text&&(prefix="else"==last_text?"SPACE":"NEWLINE"),flags.if_line&&"TK_END_EXPR"===last_type&&(flags.if_line=!1),in_array(token_text.toLowerCase(),["else","catch","finally"])?"TK_END_BLOCK"!==last_type||"expand"==opt_brace_style||"end-expand"==opt_brace_style?print_newline():(trim_output(!0),print_single_space()):"NEWLINE"===prefix?("TK_START_EXPR"!==last_type&&"="!==last_text&&","!==last_text||"function"!==token_text)&&("function"===token_text&&"new"==last_text?print_single_space():"return"===last_text||"throw"===last_text?print_single_space():"TK_END_EXPR"!==last_type?"TK_START_EXPR"===last_type&&"var"===token_text||":"===last_text||("if"===token_text&&"else"===last_word&&"{"!==last_text?print_single_space():(flags.var_line=!1,flags.var_line_reindented=!1,print_newline())):in_array(token_text,line_starters)&&")"!=last_text&&(flags.var_line=!1,flags.var_line_reindented=!1,print_newline())):is_array(flags.mode)&&","===last_text&&"}"===last_last_text?print_newline():"SPACE"===prefix&&print_single_space(),print_token(),last_word=token_text,"var"===token_text&&(flags.var_line=!0,flags.var_line_reindented=!1,flags.var_line_tainted=!1),"if"===token_text&&(flags.if_line=!0),"else"===token_text&&(flags.if_line=!1);break;case"TK_SEMICOLON":print_token(),flags.var_line=!1,flags.var_line_reindented=!1,"OBJECT"==flags.mode&&(flags.mode="BLOCK");break;case"TK_STRING":"TK_START_BLOCK"===last_type||"TK_END_BLOCK"===last_type||"TK_SEMICOLON"===last_type?print_newline():"TK_WORD"===last_type&&print_single_space(),print_token();break;case"TK_EQUALS":flags.var_line&&(flags.var_line_tainted=!0),print_single_space(),print_token(),print_single_space();break;case"TK_OPERATOR":var space_before=!0,space_after=!0;if(flags.var_line&&","===token_text&&is_expression(flags.mode)&&(flags.var_line_tainted=!1),flags.var_line&&","===token_text){if(flags.var_line_tainted){print_token(),flags.var_line_reindented=!0,flags.var_line_tainted=!1,print_newline();break}flags.var_line_tainted=!1}if("return"===last_text||"throw"===last_text){print_single_space(),print_token();break}if(":"===token_text&&flags.in_case){print_token(),print_newline(),flags.in_case=!1;break}if("::"===token_text){print_token();break}if(","===token_text){flags.var_line?flags.var_line_tainted?(print_token(),print_newline(),flags.var_line_tainted=!1):(print_token(),print_single_space()):"TK_END_BLOCK"===last_type&&"(EXPRESSION)"!==flags.mode?(print_token(),"OBJECT"===flags.mode&&"}"===last_text?print_newline():print_single_space()):"OBJECT"===flags.mode?(print_token(),print_newline()):(print_token(),print_single_space());break}in_array(token_text,["--","++","!"])||in_array(token_text,["-","+"])&&(in_array(last_type,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||in_array(last_text,line_starters))?(space_before=!1,space_after=!1,";"===last_text&&is_expression(flags.mode)&&(space_before=!0),"TK_WORD"===last_type&&in_array(last_text,line_starters)&&(space_before=!0),"BLOCK"!==flags.mode||"{"!==last_text&&";"!==last_text||print_newline()):"."===token_text?space_before=!1:":"===token_text?0==flags.ternary_depth?(flags.mode="OBJECT",space_before=!1):flags.ternary_depth-=1:"?"===token_text&&(flags.ternary_depth+=1),space_before&&print_single_space(),print_token(),space_after&&print_single_space();break;case"TK_BLOCK_COMMENT":var lines=token_text.split(/\x0a|\x0d\x0a/);if(all_lines_start_with(lines.slice(1),"*"))for(print_newline(),output.push(lines[0]),i=1;i<lines.length;i++)print_newline(),output.push(" "),output.push(trim(lines[i]));else for(lines.length>1?(print_newline(),trim_output()):print_single_space(),i=0;i<lines.length;i++)output.push(lines[i]),output.push("\n");print_newline();break;case"TK_INLINE_COMMENT":print_single_space(),print_token(),is_expression(flags.mode)?print_single_space():force_newline();break;case"TK_COMMENT":wanted_newline?print_newline():print_single_space(),print_token(),force_newline();break;case"TK_UNKNOWN":("return"===last_text||"throw"===last_text)&&print_single_space(),print_token()}last_last_text=last_text,last_type=token_type,last_text=token_text}var sweet_code=preindent_string+output.join("").replace(/[\n ]+$/,"");return sweet_code}function hex(length){if(length>8)return hex(8)+hex(length-8);var myHex=Math.random().toString(16).slice(2,2+length);return pad(myHex,length)}function pad(str,length){for(;str.length<length;)str+="0";return str}function variant(){return"89ab"[Math.floor(4*Math.random())]}function isUuid(value){return UUID_TEST.test(value)}function uuid(){return hex(8)+"-"+hex(4)+"-4"+hex(3)+"-"+variant()+hex(3)+"-"+hex(12)}function runCurrentScripts(){if("result"===document.body.className&&wb.script)wb.runScript(wb.script);else{var blocks=wb.findAll(document.body,".workspace .scripts_workspace");document.body.className="result",wb.runScript(wb.prettyScript(blocks))}}function clearStage(){document.querySelector(".stageframe").contentWindow.postMessage(JSON.stringify({command:"reset"}),"*")}function switchMode(mode){var loader=document.querySelector("#block_menu_load");loader.parentElement.removeChild(loader),document.body.className=mode,wb.loadCurrentScripts(q)}"undefined"!=typeof exports&&(exports.js_beautify=js_beautify);var hljs=new function(){function escape(value){return value.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function langRe(language,value,global){return RegExp(value,"m"+(language.case_insensitive?"i":"")+(global?"g":""))}function findCode(pre){for(var i=0;i<pre.childNodes.length;i++){var node=pre.childNodes[i];if("CODE"==node.nodeName)return node;if(3!=node.nodeType||!node.nodeValue.match(/\s+/))break}}function blockText(block,ignoreNewLines){for(var result="",i=0;i<block.childNodes.length;i++)if(3==block.childNodes[i].nodeType){var chunk=block.childNodes[i].nodeValue;ignoreNewLines&&(chunk=chunk.replace(/\n/g,"")),result+=chunk}else result+="BR"==block.childNodes[i].nodeName?"\n":blockText(block.childNodes[i]);return/MSIE [678]/.test(navigator.userAgent)&&(result=result.replace(/\r/g,"\n")),result}function blockLanguage(block){var classes=block.className.split(/\s+/);classes=classes.concat(block.parentNode.className.split(/\s+/));for(var i=0;i<classes.length;i++){var class_=classes[i].replace(/^language-/,"");if(languages[class_]||"no-highlight"==class_)return class_}}function nodeStream(node){var result=[];return function(node,offset){for(var i=0;i<node.childNodes.length;i++)3==node.childNodes[i].nodeType?offset+=node.childNodes[i].nodeValue.length:"BR"==node.childNodes[i].nodeName?offset+=1:(result.push({event:"start",offset:offset,node:node.childNodes[i]}),offset=arguments.callee(node.childNodes[i],offset),result.push({event:"stop",offset:offset,node:node.childNodes[i]}));return offset}(node,0),result}function mergeStreams(stream1,stream2,value){function selectStream(){return stream1.length&&stream2.length?stream1[0].offset!=stream2[0].offset?stream1[0].offset<stream2[0].offset?stream1:stream2:"start"==stream2[0].event?stream1:stream2:stream1.length?stream1:stream2}function open(node){for(var result="<"+node.nodeName.toLowerCase(),i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];result+=" "+attribute.nodeName.toLowerCase(),void 0!=attribute.nodeValue&&(result+='="'+escape(attribute.nodeValue)+'"')}return result+">"}for(var processed=0,result="",nodeStack=[];stream1.length||stream2.length;){var current=selectStream().splice(0,1)[0];if(result+=escape(value.substr(processed,current.offset-processed)),processed=current.offset,"start"==current.event)result+=open(current.node),nodeStack.push(current.node);else if("stop"==current.event){var i=nodeStack.length;do{i--;var node=nodeStack[i];result+="</"+node.nodeName.toLowerCase()+">"}while(node!=current.node);for(nodeStack.splice(i,1);i<nodeStack.length;)result+=open(nodeStack[i]),i++}}return result+=value.substr(processed)}function highlight(language_name,value){function subMode(lexem,mode){for(var i=0;i<mode.contains.length;i++)if(mode.contains[i].beginRe.test(lexem))return mode.contains[i]}function endOfMode(mode_index,lexem){if(modes[mode_index].end&&modes[mode_index].endRe.test(lexem))return 1;if(modes[mode_index].endsWithParent){var level=endOfMode(mode_index-1,lexem);return level?level+1:0}return 0}function isIllegal(lexem,mode){return mode.illegalRe&&mode.illegalRe.test(lexem)}function compileTerminators(mode,language){for(var terminators=[],i=0;i<mode.contains.length;i++)terminators.push(mode.contains[i].begin);var index=modes.length-1;do modes[index].end&&terminators.push(modes[index].end),index--;while(modes[index+1].endsWithParent);return mode.illegal&&terminators.push(mode.illegal),langRe(language,"("+terminators.join("|")+")",!0)}function eatModeChunk(value,index){var mode=modes[modes.length-1];mode.terminators||(mode.terminators=compileTerminators(mode,language)),mode.terminators.lastIndex=index;var match=mode.terminators.exec(value);return match?[value.substr(index,match.index-index),match[0],!1]:[value.substr(index),"",!0]}function keywordMatch(mode,match){var match_str=language.case_insensitive?match[0].toLowerCase():match[0];for(var className in mode.keywordGroups)if(mode.keywordGroups.hasOwnProperty(className)){var value=mode.keywordGroups[className].hasOwnProperty(match_str);if(value)return[className,value]}return!1}function processKeywords(buffer,mode){if(!mode.keywords)return escape(buffer);var result="",last_index=0;mode.lexemsRe.lastIndex=0;for(var match=mode.lexemsRe.exec(buffer);match;){result+=escape(buffer.substr(last_index,match.index-last_index));var keyword_match=keywordMatch(mode,match);keyword_match?(keyword_count+=keyword_match[1],result+='<span class="'+keyword_match[0]+'">'+escape(match[0])+"</span>"):result+=escape(match[0]),last_index=mode.lexemsRe.lastIndex,match=mode.lexemsRe.exec(buffer)}return result+=escape(buffer.substr(last_index,buffer.length-last_index))}function processBuffer(buffer,mode){if(mode.subLanguage&&languages[mode.subLanguage]){var result=highlight(mode.subLanguage,buffer);return keyword_count+=result.keyword_count,result.value}return processKeywords(buffer,mode)}function startNewMode(mode,lexem){var markup=mode.className?'<span class="'+mode.className+'">':"";mode.returnBegin?(result+=markup,mode.buffer=""):mode.excludeBegin?(result+=escape(lexem)+markup,mode.buffer=""):(result+=markup,mode.buffer=lexem),modes.push(mode),relevance+=mode.relevance}function processModeInfo(buffer,lexem,end){var current_mode=modes[modes.length-1];if(end)return result+=processBuffer(current_mode.buffer+buffer,current_mode),!1;var new_mode=subMode(lexem,current_mode);if(new_mode)return result+=processBuffer(current_mode.buffer+buffer,current_mode),startNewMode(new_mode,lexem),new_mode.returnBegin;var end_level=endOfMode(modes.length-1,lexem);if(end_level){var markup=current_mode.className?"</span>":"";for(result+=current_mode.returnEnd?processBuffer(current_mode.buffer+buffer,current_mode)+markup:current_mode.excludeEnd?processBuffer(current_mode.buffer+buffer,current_mode)+markup+escape(lexem):processBuffer(current_mode.buffer+buffer+lexem,current_mode)+markup;end_level>1;)markup=modes[modes.length-2].className?"</span>":"",result+=markup,end_level--,modes.length--;var last_ended_mode=modes[modes.length-1];return modes.length--,modes[modes.length-1].buffer="",last_ended_mode.starts&&startNewMode(last_ended_mode.starts,""),current_mode.returnEnd}if(isIllegal(lexem,current_mode))throw"Illegal"}var language=languages[language_name],modes=[language.defaultMode],relevance=0,keyword_count=0,result="";try{var index=0;language.defaultMode.buffer="";do{var mode_info=eatModeChunk(value,index),return_lexem=processModeInfo(mode_info[0],mode_info[1],mode_info[2]);index+=mode_info[0].length,return_lexem||(index+=mode_info[1].length)}while(!mode_info[2]);if(modes.length>1)throw"Illegal";return{language:language_name,relevance:relevance,keyword_count:keyword_count,value:result}}catch(e){if("Illegal"==e)return{language:null,relevance:0,keyword_count:0,value:escape(value)};throw e}}function compileModes(){function compileMode(mode,language,is_default){if(!mode.compiled){is_default||(mode.beginRe=langRe(language,mode.begin?mode.begin:"\\B|\\b"),mode.end||mode.endsWithParent||(mode.end="\\B|\\b"),mode.end&&(mode.endRe=langRe(language,mode.end))),mode.illegal&&(mode.illegalRe=langRe(language,mode.illegal)),void 0==mode.relevance&&(mode.relevance=1),mode.keywords&&(mode.lexemsRe=langRe(language,mode.lexems||hljs.IDENT_RE,!0));for(var key in mode.keywords)if(mode.keywords.hasOwnProperty(key)){mode.keywordGroups=mode.keywords[key]instanceof Object?mode.keywords:{keyword:mode.keywords};break}mode.contains||(mode.contains=[]),mode.compiled=!0;for(var i=0;i<mode.contains.length;i++)compileMode(mode.contains[i],language,!1);mode.starts&&compileMode(mode.starts,language,!1)}}for(var i in languages)languages.hasOwnProperty(i)&&compileMode(languages[i].defaultMode,languages[i],!0)}function initialize(){initialize.called||(initialize.called=!0,compileModes())}function highlightBlock(block,tabReplace,useBR){initialize();var text=blockText(block,useBR),language=blockLanguage(block);if("no-highlight"!=language){if(language)var result=highlight(language,text);else{var result={language:"",keyword_count:0,relevance:0,value:escape(text)},second_best=result;for(var key in languages)if(languages.hasOwnProperty(key)){var current=highlight(key,text);current.keyword_count+current.relevance>second_best.keyword_count+second_best.relevance&&(second_best=current),current.keyword_count+current.relevance>result.keyword_count+result.relevance&&(second_best=result,result=current)}}var class_name=block.className;class_name.match(result.language)||(class_name=class_name?class_name+" "+result.language:result.language);var original=nodeStream(block);if(original.length){var pre=document.createElement("pre");pre.innerHTML=result.value,result.value=mergeStreams(original,nodeStream(pre),text)}if(tabReplace&&(result.value=result.value.replace(/^((<[^>]+>|\t)+)/gm,function(match,p1){return p1.replace(/\t/g,tabReplace)})),useBR&&(result.value=result.value.replace(/\n/g,"<br>")),/MSIE [678]/.test(navigator.userAgent)&&"CODE"==block.tagName&&"PRE"==block.parentNode.tagName){var pre=block.parentNode,container=document.createElement("div");container.innerHTML="<pre><code>"+result.value+"</code></pre>",block=container.firstChild.firstChild,container.firstChild.className=pre.className,pre.parentNode.replaceChild(container.firstChild,pre)}else block.innerHTML=result.value;block.className=class_name,block.dataset={},block.dataset.result={language:result.language,kw:result.keyword_count,re:result.relevance},second_best&&second_best.language&&(block.dataset.second_best={language:second_best.language,kw:second_best.keyword_count,re:second_best.relevance})}}function initHighlighting(){if(!initHighlighting.called){initHighlighting.called=!0,initialize();for(var pres=document.getElementsByTagName("pre"),i=0;i<pres.length;i++){var code=findCode(pres[i]);code&&highlightBlock(code,hljs.tabReplace)}}}function initHighlightingOnLoad(){var original_arguments=arguments,handler=function(){initHighlighting.apply(null,original_arguments)};window.addEventListener?(window.addEventListener("DOMContentLoaded",handler,!1),window.addEventListener("load",handler,!1)):window.attachEvent?window.attachEvent("onload",handler):window.onload=handler}var languages={};this.LANGUAGES=languages,this.initHighlightingOnLoad=initHighlightingOnLoad,this.highlightBlock=highlightBlock,this.initHighlighting=initHighlighting,this.IDENT_RE="[a-zA-Z][a-zA-Z0-9_]*",this.UNDERSCORE_IDENT_RE="[a-zA-Z_][a-zA-Z0-9_]*",this.NUMBER_RE="\\b\\d+(\\.\\d+)?",this.C_NUMBER_RE="\\b(0x[A-Za-z0-9]+|\\d+(\\.\\d+)?)",this.RE_STARTERS_RE="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",this.BACKSLASH_ESCAPE={begin:"\\\\.",relevance:0},this.APOS_STRING_MODE={className:"string",begin:"'",end:"'",illegal:"\\n",contains:[this.BACKSLASH_ESCAPE],relevance:0},this.QUOTE_STRING_MODE={className:"string",begin:'"',end:'"',illegal:"\\n",contains:[this.BACKSLASH_ESCAPE],relevance:0},this.C_LINE_COMMENT_MODE={className:"comment",begin:"//",end:"$"},this.C_BLOCK_COMMENT_MODE={className:"comment",begin:"/\\*",end:"\\*/"},this.HASH_COMMENT_MODE={className:"comment",begin:"#",end:"$"},this.NUMBER_MODE={className:"number",begin:this.NUMBER_RE,relevance:0},this.C_NUMBER_MODE={className:"number",begin:this.C_NUMBER_RE,relevance:0},this.inherit=function(parent,obj){var result={};for(var key in parent)result[key]=parent[key];if(obj)for(var key in obj)result[key]=obj[key];return result}};hljs.LANGUAGES.javascript={defaultMode:{keywords:{keyword:{"in":1,"if":1,"for":1,"while":1,"finally":1,"var":1,"new":1,"function":1,"do":1,"return":1,"void":1,"else":1,"break":1,"catch":1,"instanceof":1,"with":1,"throw":1,"case":1,"default":1,"try":1,"this":1,"switch":1,"continue":1,"typeof":1,"delete":1},literal:{"true":1,"false":1,"null":1}},contains:[hljs.APOS_STRING_MODE,hljs.QUOTE_STRING_MODE,hljs.C_LINE_COMMENT_MODE,hljs.C_BLOCK_COMMENT_MODE,hljs.C_NUMBER_MODE,{begin:"("+hljs.RE_STARTERS_RE+"|case|return|throw)\\s*",keywords:{"return":1,"throw":1,"case":1},contains:[hljs.C_LINE_COMMENT_MODE,hljs.C_BLOCK_COMMENT_MODE,{className:"regexp",begin:"/.*?[^\\\\/]/[gim]*"}],relevance:0},{className:"function",begin:"\\bfunction\\b",end:"{",keywords:{"function":1},contains:[{className:"title",begin:"[A-Za-z$_][0-9A-Za-z$_]*"},{className:"params",begin:"\\(",end:"\\)",contains:[hljs.APOS_STRING_MODE,hljs.QUOTE_STRING_MODE,hljs.C_LINE_COMMENT_MODE,hljs.C_BLOCK_COMMENT_MODE]}]}]}};var wb={};wb.urlToQueryParams=function(url){var qparts,qpart,qparams={},parts=(url||"").split("?"),i=0;if(parts.length<=1)return qparams;qparts=parts[1].split("&");for(i in qparts)qpart=qparts[i].split("="),qparams[decodeURIComponent(qpart[0])]=decodeURIComponent(qpart[1]||"");return qparams},wb.queryParamsToUrl=function(params){var base=location.href.split("?")[0],keys=Object.keys(params),parts=[];return keys.forEach(function(key){Array.isArray(params[key])?params[key].forEach(function(value){parts.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}):parts.push(encodeURIComponent(key)+"="+encodeURIComponent(params[key]))}),base+"?"+parts.join("&")};var q=wb.urlToQueryParams(location.href);wb.queryParams=q,wb.view=wb.queryParams.view||"editor",function(){wb.makeArray=function(arrayLike){return Array.prototype.slice.call(arrayLike)},wb.reposition=function(elem,position){elem.style.top=position.top+"px",elem.style.left=position.left+"px"},wb.hide=function(elem){elem.dataset.display=elem.style.display,elem.style.display="none"
},wb.show=function(elem){elem.style.display=elem.dataset.display||"block",delete elem.dataset.display};var svgtext=document.querySelector("svg text");wb.resize=function(input){input.wbTarget&&(input=input.wbTarget),svgtext.textContent=input.value;var width=svgtext.getComputedTextLength();input.style.width=width+20+"px"},wb.dist=function(p1,p2,m1,m2){return Math.sqrt(Math.pow(p1-m1,2)+Math.pow(p2-m2,2))},wb.overlapRect=function(r1,r2){if(r1.left>r2.right)return 0;if(r1.right<r2.left)return 0;if(r1.top>r2.bottom)return 0;if(r1.bottom<r2.top)return 0;var max=Math.max,min=Math.min;return(max(r1.left,r2.left)-min(r1.right,r2.right))*(max(r1.top,r2.top)-min(r1.bottom,r2.bottom))},wb.rect=function(elem){return elem.getBoundingClientRect()},wb.overlap=function(elem1,elem2){return wb.overlapRect(wb.rect(elem1),wb.rect(elem2))},wb.area=function(elem){return elem.clientWidth*elem.clientHeight},wb.containedBy=function(target,container){var targetArea=Math.min(wb.area(target),.9*wb.area(container));return target.overlap(container)>=targetArea},wb.closest=function(elem,selector){for(elem.jquery&&(elem=elem[0]);elem;){if(wb.matches(elem,selector))return elem;if(!elem.parentElement)throw new Error("Element has no parent, is it in the tree? %o",elem);elem=elem.parentElement}return null},wb.indexOf=function(elem){for(var idx=0;elem.previousSiblingElement;)elem=elem.previousSiblingElement,idx++;return idx},wb.find=function(elem,selector){return elem.querySelector(selector)},wb.findAll=function(elem,selector){return wb.makeArray(elem.querySelectorAll(selector))},wb.findChildren=function(elem,selector){return wb.makeArray(elem.children).filter(function(item){return wb.matches(item,selector)})},wb.findChild=function(elem,selector){if(2!==arguments.length)throw new Exception("This is the culprit");for(var children=elem.children,i=0;i<children.length;i++){var child=children[i];if(wb.matches(child,selector))return child}return null},wb.elem=function elem(name,attributes,children){var e,val;return e=name.jquery?name[0]:name.nodeType?name:document.createElement(name),attributes&&Object.keys(attributes).forEach(function(key){null!==attributes[key]&&void 0!==attributes[key]&&("function"==typeof attributes[key]?(val=attributes[key](attributes),val&&e.setAttribute(key,val)):e.setAttribute(key,attributes[key]))}),children&&(Array.isArray(children)?children.forEach(function(child){child.nodeName?e.appendChild(child):Array.isArray(child)?(console.log("DEPRECATED array arg to elem: use sub-elem instead"),e.appendChild(elem(child[0],child[1],child[2]))):e.appendChild(document.createTextNode(child))}):children.nodeName?e.appendChild(children):e.appendChild(document.createTextNode(children))),e},document.body.matches?wb.matches=function(elem,selector){return wb.elem(elem).matches(selector)}:document.body.mozMatchesSelector?wb.matches=function(elem,selector){return wb.elem(elem).mozMatchesSelector(selector)}:document.body.webkitMatchesSelector?wb.matches=function(elem,selector){return wb.elem(elem).webkitMatchesSelector(selector)}:document.body.msMatchesSelector?wb.matches=function(elem,selector){return wb.elem(elem).msMatchesSelector(selector)}:document.body.oMatchesSelector&&(wb.matches=function(elem,selector){return wb.elem(elem).oMatchesSelector(selector)}),wb.jsonp=function(url,callback){var id="handler"+Math.floor(65535*Math.random()),handler=function(data){var script=document.getElementById(id);script.parentElement.removeChild(script),delete window[id],callback(data)};window[id]=handler,document.head.appendChild(wb.elem("script",{src:url+"?callback="+id,id:id}))}}(this),function(global){"use strict";var on=function on(elem,eventname,selector,handler){if("string"==typeof elem)return wb.makeArray(document.querySelectorAll(elem)).map(function(e){return on(e,eventname,selector,handler)});elem.tagName||console.error("first argument must be element"),"string"!=typeof eventname&&console.error("second argument must be eventname"),selector&&"string"!=typeof selector&&console.log("third argument must be selector or null"),"function"!=typeof handler&&console.log("fourth argument must be handler");var listener;return listener=selector?function(event){blend(event),event.wbValid&&(wb.matches(event.wbTarget,selector)?handler(event):wb.matches(event.wbTarget,selector+" *")&&(event.wbTarget=wb.closest(event.wbTarget,selector),handler(event)))}:function(event){blend(event),event.wbValid&&handler(event)},elem.addEventListener(eventname,listener,!1),listener},off=function(elem,eventname,handler){elem.removeEventListener(eventname,handler)},once=function(elem,eventname,selector,handler){var listener=function listener(event){handler(event),Event.off(elem,eventname,listener)};return Event.on(elem,eventname,selector,listener)},trigger=function(elemOrSelector,eventname,data){var elem;elem=elemOrSelector.nodeName?elemOrSelector:document.querySelector(elem);var evt=new CustomEvent(eventname,{bubbles:!0,cancelable:!0,detail:data});elem.dispatchEvent(evt)},isTouch="ontouchstart"in global,isPointerEvent=function(event){switch(event.type){case"touchstart":case"touchmove":case"touchend":case"tap":case"mousedown":case"mousemove":case"mouseup":case"click":return!0;default:return!1}},blend=function(event){if(isPointerEvent(event))if(isTouch){if(event.touches.length>1)return event;var touch=event.touches[0];event.wbTarget=touch.target,event.wbPageX=touch.pageX,event.wbPageY=touch.pageY,event.wbValid=!0}else{if(1!==event.which)return event;event.wbTarget=event.target,event.wbPageX=event.pageX,event.wbPageY=event.pageY,event.wbValid=!0}else event.wbTarget=event.target,event.wbValid=!0;return event};global.Event={on:on,off:off,once:once,trigger:trigger,isTouch:isTouch}}(this),function(){function dropCursor(){return _dropCursor||(_dropCursor=document.querySelector(".dropCursor")),_dropCursor}function reset(){dragTarget=null,potentialDropTargets=[],dropRects=[],dropTarget=null,startPosition=null,currentPosition=null,timer=null,dragging=!1,cloned=!1,scope=null}function initDrag(event){var eT=event.wbTarget;if(wb.matches(event.target,"input, select, option, .disclosure,.scripts_workspace")&&!wb.matches(eT,"#block_menu *"))return console.log("not a drag handle"),void 0;var target=wb.closest(eT,".block");return target?(dragTarget=target,target.parentElement.classList.contains("block-menu")&&(target.dataset.isTemplateBlock="true"),target.parentElement.classList.contains("local")&&(target.dataset.isLocal="true"),startPosition=wb.rect(target),wb.matches(target.parentElement,".scripts_workspace")||(startParent=target.parentElement),wb.matches(target,".step")&&(startIndex=wb.indexOf(target))):(console.log("not a valid drag target"),dragTarget=null),!1}function startDrag(event){if(!dragTarget)return void 0;if(dragTarget.classList.add("dragIndication"),currentPosition={left:event.wbPageX,top:event.wbPageY},dragTarget.dataset.isTemplateBlock){dragTarget.classList.remove("dragIndication");var parent=dragTarget.parentElement;dragTarget=wb.cloneBlock(dragTarget),dragTarget.classList.add("dragIndication"),scope=dragTarget.dataset.isLocal?wb.closest(parent,".context"):null,cloned=!0,wb.showWorkspace("block")}else Event.trigger(dragTarget,"wb-remove");return dragging=!0,dragTarget.style.position="absolute",document.querySelector(".content.editor").appendChild(dragTarget),cloned&&Event.trigger(dragTarget,"wb-clone"),wb.reposition(dragTarget,startPosition),potentialDropTargets=getPotentialDropTargets(dragTarget),dropRects=potentialDropTargets.map(function(elem){return elem.classList.add("dropTarget"),wb.rect(elem)}),timer=setTimeout(hitTest,dragTimeout),!1}function drag(event){if(!dragTarget)return void 0;currentPosition||startDrag(event),event.preventDefault();var nextPosition={left:event.wbPageX,top:event.wbPageY},dX=nextPosition.left-currentPosition.left,dY=nextPosition.top-currentPosition.top,currPos=wb.rect(dragTarget);if(wb.reposition(dragTarget,{left:currPos.left+dX,top:currPos.top+dY}),workspace){var container=workspace.parentElement,offset=wb.rect(container);if(currPos.top<offset.top)container.scrollTop-=Math.min(container.scrollTop,offset.top-currPos.top);else if(currPos.bottom>offset.bottom){var maxVerticalScroll=container.scrollHeight-offset.height-container.scrollTop;container.scrollTop+=Math.min(maxVerticalScroll,currPos.bottom-offset.bottom)}if(currPos.left<offset.left)container.scrollLeft-=Math.min(container.scrollLeft,offset.left-currPos.left);else if(currPos.right>offset.right){var maxHorizontalScroll=container.scrollWidth-offset.width-container.scrollLeft;console.log("maxHorizontalScroll: %s",maxHorizontalScroll),container.scrollLeft+=Math.min(maxHorizontalScroll,currPos.right-offset.right)}}return currentPosition=nextPosition,!1}function endDrag(){return clearTimeout(timer),timer=null,dragging?(handleDrop(),reset(),!1):void 0}function handleDrop(){dragTarget.classList.remove("dragActive"),dragTarget.classList.remove("dragIndication"),potentialDropTargets.forEach(function(elem){elem.classList.remove("dropTarget")}),wb.overlap(dragTarget,blockMenu)?(Event.trigger(dragTarget,"wb-delete"),dragTarget.parentElement.removeChild(dragTarget)):dropTarget?(dropTarget.classList.remove("dropActive"),wb.matches(dragTarget,".step")?(dropTarget.insertBefore(dragTarget,dropCursor()),dragTarget.removeAttribute("style"),Event.trigger(dragTarget,"wb-add")):(dropTarget.appendChild(dragTarget),dragTarget.removeAttribute("style"),Event.trigger(dragTarget,"wb-add"))):cloned?dragTarget.parentElement.removeChild(dragTarget):startParent?(wb.matches(startParent,".socket"),startParent.appendChild(dragTarget),dragTarget.removeAttribute("style"),startParent=null):(workspace.appendChild(dragTarget),wb.reposition(dragTarget,startPosition))}function positionExpressionDropCursor(){if(!potentialDropTargets.length)return console.log("no drop targets found"),void 0;var targets=potentialDropTargets.map(function(target){return[wb.overlap(dragTarget,target),target]});targets.sort().reverse(),dropTarget&&dropTarget.classList.remove("dropActive"),dropTarget=targets[0][1],dropTarget.classList.add("dropActive")}function positionDropCursor(){var dragRect=wb.rect(wb.findChild(dragTarget,".label")),cy=dragRect.top+dragRect.height/2,overlapping=potentialDropTargets.filter(function(item){var r=wb.rect(item);return cy<r.top?!1:cy>r.bottom?!1:!0});if(overlapping.sort(function(a,b){return wb.rect(b).left-wb.rect(a).left}),!overlapping.length)return workspace.appendChild(dropCursor()),dropTarget=workspace,void 0;dropTarget=overlapping[0];var position,middle,siblings=wb.findChildren(dropTarget,".step");if(!siblings.length)return dropTarget.appendChild(dropCursor()),void 0;for(var sIdx=0;sIdx<siblings.length;sIdx++){var sibling=siblings[sIdx];if(position=wb.rect(sibling),!(cy<position.top-4||cy>position.bottom+4))return middle=position.top+position.height/2,middle>cy?(dropTarget.insertBefore(dropCursor(),sibling),void 0):(dropTarget.insertBefore(dropCursor(),sibling.nextSibling),void 0)}dropTarget.appendChild(dropCursor())}function hitTest(){dragTarget&&(wb.matches(dragTarget,".expression")?positionExpressionDropCursor():positionDropCursor(),setTimeout(hitTest,dragTimeout))}function expressionDropTypes(expressionType){switch(expressionType){case"number":return[".number",".int",".float",".any"];case"int":return[".number",".int",".float",".any"];case"float":return[".number",".float",".any"];case"any":return[];default:return["."+expressionType,".any"]}}function hasChildBlock(elem){return!wb.findChild(elem,".block")}function getPotentialDropTargets(view){workspace||(workspace=document.querySelector(".scripts_workspace").querySelector(".contained"));var blocktype=view.dataset.blocktype;switch(blocktype){case"step":case"context":return scope?wb.findAll(scope,".contained"):wb.findAll(workspace,".contained").concat([workspace]);case"expression":var selector=expressionDropTypes(view.dataset.type).map(dataSelector).join(",");return selector&&selector.length||(selector=".socket > .holder"),scope?wb.findAll(scope,selector).filter(hasChildBlock):wb.findAll(workspace,selector).filter(hasChildBlock);case"eventhandler":return[workspace];default:throw new Error("Unrecognized blocktype: "+blocktype)}}function dataSelector(name){return"."===name[0]&&(name=name.slice(1)),".socket[data-type="+name+"] > .holder"}var startParent,startIndex,timer,dragTarget,dropTarget,dragging,currentPosition,scope,workspace,potentialDropTargets,_dropCursor,dragTimeout=20,blockMenu=document.querySelector("#block_menu");reset(),wb.initializeDragHandlers=function(){Event.isTouch?(Event.on(".scripts_workspace .contained, .block-menu","touchstart",".block",initDrag),Event.on(".content","touchmove",null,drag),Event.on(".content","touchend",null,endDrag)):(Event.on(".scripts_workspace .contained, .block-menu","mousedown",".block",initDrag),Event.on(".content","mousemove",null,drag),Event.on(".content","mouseup",null,endDrag))}}(this);var UUID_TEST=/[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}/;switch(function(wb){function removeBlock(event){event.stopPropagation(),wb.matches(event.wbTarget,".expression")?removeExpression(event):removeStep(event)}function addBlock(event){event.stopPropagation(),wb.matches(event.wbTarget,".expression")?addExpression(event):addStep(event)}function removeStep(event){var block=event.wbTarget;if(block.classList.contains("step")&&!block.classList.contains("context")){var parent=wb.closest(block,".context");if(block.dataset.locals&&block.dataset.locals.length){var locals=wb.findAll(parent,'[data-local-source="'+block.id+'"]');locals.forEach(function(local){local.isTemplateBlock||Event.trigger(local,"wb-remove"),local.parentElement.removeChild(local)}),delete block.dataset.localsAdded}}}function removeExpression(event){var block=event.wbTarget;wb.findChildren(block.parentElement,"input, select").forEach(function(elem){elem.removeAttribute("style")})}function addStep(event){var block=event.wbTarget;if(block.dataset.locals&&block.dataset.locals.length&&!block.dataset.localsAdded){var parent=wb.closest(block,".context"),locals=wb.findChild(parent,".locals"),parsedLocals=[];JSON.parse(block.dataset.locals).forEach(function(spec){spec.isTemplateBlock=!0,spec.isLocal=!0,spec.group=block.dataset.group,spec.seqNum||(spec.seqNum=block.dataset.seqNum),spec.scopeId=parent.id,spec.id||(spec.id=spec.scriptId=uuid()),spec.localSource=block.id,block.dataset.localsAdded=!0,locals.appendChild(Block(spec)),parsedLocals.push(spec)}),block.dataset.locals=JSON.stringify(parsedLocals)}}function addExpression(event){var block=event.wbTarget;wb.findChildren(block.parentElement,"input, select").forEach(function(elem){elem.style.display="none"}),event.stopPropagation&&event.stopPropagation()}function onClone(event){event.wbTarget}function socketDesc(socket){var desc={name:socket.dataset.name};socket.dataset.type&&(desc.type=socket.dataset.type),socket.dataset.value&&(desc.value=socket.dataset.value),socket.dataset.options&&(desc.options=socket.dataset.options),socket.dataset.block&&(desc.block=socket.dataset.block);var uName=wb.findChild(socket,".name").textContent;wb.findChild(socket,".name"),desc.name!==uName&&(desc.uName=uName);var holder=wb.findChild(socket,".holder");if(holder){var input=wb.findChild(holder,"input, select");desc.uValue=input.value,wb.findChild(holder,".block"),wb.matches(holder.lastElementChild,".block")&&(desc.uBlock=blockDesc(holder.lastElementChild))}return desc}function blockDesc(block){var label=wb.findChild(block,".label"),sockets=wb.findChildren(label,".socket"),desc={blocktype:block.dataset.blocktype,group:block.dataset.group,id:block.id,help:block.title,scopeId:block.dataset.scopeId,scriptId:block.dataset.scriptId,sockets:sockets.map(socketDesc)};block.dataset.seqNum&&(desc.seqNum=block.dataset.seqNum),block.dataset.script&&(desc.script=block.dataset.script),block.dataset.isTemplateBlock&&(desc.isTemplateBlock=!0),block.dataset.isLocal&&(desc.isLocal=!0),block.dataset.localSource&&(desc.localSource=block.dataset.localSource),block.dataset.type&&(desc.type=block.dataset.type),block.dataset.locals&&(desc.locals=JSON.parse(block.dataset.locals)),block.dataset.closed&&(desc.closed=!0);var contained=wb.findChild(block,".contained");return contained&&contained.children.length&&(desc.contained=wb.findChildren(contained,".block").map(blockDesc)),desc}function cloneBlock(block){var blockdesc=blockDesc(block);return delete blockdesc.id,blockdesc.isLocal||delete blockdesc.seqNum,delete blockdesc.isTemplateBlock,delete blockdesc.isLocal,blockdesc.scriptId=block.id,Block(blockdesc)}function deleteBlock(event){event.wbTarget}function changeName(event){var nameSpan=event.wbTarget,input=elem("input",{value:nameSpan.textContent});nameSpan.parentNode.appendChild(input),nameSpan.style.display="none",input.focus(),input.select(),wb.resize(input),Event.on(input,"blur",null,updateName),Event.on(input,"keydown",null,maybeUpdateName)}function updateName(event){console.log("updateName on %o",event);var input=event.wbTarget;Event.off(input,"blur",updateName),Event.off(input,"keydown",maybeUpdateName);var nameSpan=input.previousSibling,newName=input.value;input.parentElement.removeChild(input),nameSpan.style.display="initial",console.log("now update all instances too");var source=wb.closest(nameSpan,".block"),instances=wb.findAll(wb.closest(source,".context"),'[data-local-source="'+source.dataset.localSource+'"]');instances.forEach(function(elem){wb.find(elem,".name").textContent=newName})}function maybeUpdateName(event){var input=event.wbTarget;27===event.keyCode?(event.preventDefault(),input.value=input.previousSibling.textContent,input.blur()):(13===event.keyCode||9===event.keyCode)&&(event.preventDefault(),input.blur())}var elem=wb.elem,_nextSeqNum=0,newSeqNum=function(){return _nextSeqNum++,_nextSeqNum},registerSeqNum=function(seqNum){seqNum&&(seqNum=Math.max(parseInt(seqNum,10),_nextSeqNum))},blockRegistry={};wb.blockRegistry=blockRegistry;var registerBlock=function(blockdesc){blockdesc.seqNum?registerSeqNum(blockdesc.seqNum):blockdesc.isTemplateBlock||(blockdesc.seqNum=newSeqNum()),blockdesc.id||(blockdesc.id=uuid()),blockRegistry[blockdesc.id]=blockdesc},getHelp=function(id){return blockRegistry[id]?blockRegistry[id].help:""},getScript=function(id){try{return blockRegistry[id].script}catch(e){return console.log("Error: could not get script for %o",id),console.log("Hey look: %o",document.getElementById(id)),""}},createSockets=function(obj){return obj.sockets.map(function(socket_descriptor){return Socket(socket_descriptor,obj)})},Block=function(obj){registerBlock(obj);var block=elem("div",{"class":function(){var names=["block",obj.group,obj.blocktype];return"context"===obj.blocktype?names.push("step"):"eventhandler"===obj.blocktype&&(names.push("step"),names.push("context")),names.join(" ")},"data-blocktype":obj.blocktype,"data-group":obj.group,id:obj.id,"data-scope-id":obj.scopeId||0,"data-script-id":obj.scriptId||obj.id,"data-local-source":obj.localSource||null,"data-sockets":JSON.stringify(obj.sockets),"data-locals":JSON.stringify(obj.locals),title:obj.help||getHelp(obj.scriptId||obj.id)},elem("div",{"class":"label"},createSockets(obj)));if(obj.seqNum&&(block.dataset.seqNum=obj.seqNum),obj.type&&(block.dataset.type=obj.type),obj.script&&(block.dataset.script=obj.script),obj.isLocal&&(block.dataset.isLocal=obj.isLocal),obj.isTemplateBlock&&(block.dataset.isTemplateBlock=obj.isTemplateBlock),obj.closed&&(block.dataset.closed=!0),"context"===obj.blocktype||"eventhandler"===obj.blocktype){block.appendChild(elem("div",{"class":"locals block-menu"}));var contained=elem("div",{"class":"contained"});if(block.appendChild(contained),obj.contained&&obj.contained.map(function(childdesc){var child=Block(childdesc);contained.appendChild(child),addStep({wbTarget:child})}),!wb.matches(block,".scripts_workspace")){var label=wb.findChild(block,".label");label.insertBefore(elem("div",{"class":"disclosure"}),label.firstElementChild)}}return block};Event.on(document.body,"wb-remove",".block",removeBlock),Event.on(document.body,"wb-add",".block",addBlock),Event.on(document.body,"wb-clone",".block",onClone),Event.on(document.body,"wb-delete",".block",deleteBlock);var Socket=function(desc,blockdesc){var socket=elem("div",{"class":"socket","data-name":desc.name,"data-id":blockdesc.id},elem("span",{"class":"name"},desc.uName||desc.name));if(desc.value&&(socket.dataset.value=desc.value),desc.options&&(socket.dataset.options=desc.options),socket.firstElementChild.innerHTML=socket.firstElementChild.innerHTML.replace(/##/,' <span class="seq-num">'+(blockdesc.seqNum||"##")+"</span>"),desc.type){socket.dataset.type=desc.type;var holder=elem("div",{"class":"holder"},[Default(desc)]);socket.appendChild(holder)}if(desc.block&&(socket.dataset.block=desc.block),!blockdesc.isTemplateBlock){var newBlock=null;desc.uBlock?newBlock=Block(desc.uBlock):desc.block&&(newBlock=cloneBlock(document.getElementById(desc.block))),newBlock&&(holder.appendChild(newBlock),addExpression({wbTarget:newBlock}))}return socket},Default=function(obj){var value,type=obj.type;switch(("int"===type||"float"===type)&&(type="number"),type){case"any":value=obj.uValue||obj.value||"";break;case"number":value=obj.uValue||obj.value||0;break;case"string":value=obj.uValue||obj.value||"";break;case"color":value=obj.uValue||obj.value||"#000000";break;case"date":value=obj.uValue||obj.value||(new Date).toISOString().split("T")[0];break;case"time":value=obj.uValue||obj.value||(new Date).toISOString().split("T")[1];break;case"datetime":value=obj.uValue||obj.value||(new Date).toISOString();break;case"url":value=obj.uValue||obj.value||"http://waterbearlang.com/";break;case"image":value=obj.uValue||obj.value||"";break;case"phone":value=obj.uValue||obj.value||"604-555-1212";break;case"email":value=obj.uValue||obj.value||"waterbear@waterbearlang.com";break;case"boolean":obj.options="boolean";case"choice":var choice=elem("select");return wb.choiceLists[obj.options].forEach(function(opt){var option=elem("option",{},opt),value=obj.uValue||obj.value;value&&value===opt&&option.setAttribute("selected","selected"),choice.appendChild(option)}),choice;default:value=obj.uValue||obj.value||""}var input=elem("input",{type:type,value:value});return wb.resize(input),input},socketValue=function(holder){if(holder.children.length>1)return codeFromBlock(wb.findChild(holder,".block"));var value=wb.findChild(holder,"input, select").value,type=holder.parentElement.dataset.type;return("string"===type||"choice"===type)&&('"'===value[0]&&(value=value.slice(1)),'"'===value[value.length-1]&&(value=value.slice(0,-1)),value=value.replace(/"/g,'\\"'),value='"'+value+'"'),value},codeFromBlock=function(block){function replace_values(match){var idx=parseInt(match.slice(2,-2),10)-1;return"{"===match[0]?expressionValues[idx]||"null":childValues||"/* do nothing */"}var scriptTemplate=getScript(block.dataset.scriptId).replace(/##/g,"_"+block.dataset.seqNum),childValues=[],label=wb.findChild(block,".label"),expressionValues=wb.findChildren(label,".socket").map(function(socket){return wb.findChild(socket,".holder")}).filter(function(holder){return holder}).map(socketValue);if(wb.matches(block,".context"))var childValues=wb.findChildren(wb.findChild(block,".contained"),".block").map(codeFromBlock).join("");var _code=scriptTemplate.replace(/\{\{\d\}\}/g,replace_values),_code2=_code.replace(/\[\[\d\]\]/g,replace_values);return _code2};wb.Block=Block,wb.blockDesc=blockDesc,wb.registerSeqNum=registerSeqNum,wb.cloneBlock=cloneBlock,wb.codeFromBlock=codeFromBlock,wb.addBlockHandler=addBlock,wb.changeName=changeName}(wb),function(wb){function tabSelect(event){var target=event.wbTarget;document.querySelector(".tabbar .selected").classList.remove("selected"),target.classList.add("selected"),wb.matches(target,".scripts_workspace_tab")?showWorkspace("block"):wb.matches(target,".scripts_text_view_tab")&&(showWorkspace("text"),updateScriptsView())}function accordion(event){var open=document.querySelector("#block_menu .open");open&&open.classList.remove("open"),open&&open===event.wbTarget.nextSibling||event.wbTarget.nextSibling.classList.add("open")}function showWorkspace(mode){var workspace=document.querySelector(".workspace");"block"===mode?(workspace.classList.remove("textview"),workspace.classList.add("blockview")):"text"===mode&&(workspace.classList.remove("blockview"),workspace.classList.add("textview"))}function updateScriptsView(){var blocks=wb.findAll(document.body,".workspace .scripts_workspace"),view=wb.find(document.body,".workspace .scripts_text_view");wb.writeScript(blocks,view)}function run_menu(title,specs){edit_menu(title,specs)}function edit_menu(title,specs){menu_built=!0;var group=title.toLowerCase().split(/\s+/).join(""),submenu=document.querySelector("."+group+"+ .submenu");if(!submenu){var header=wb.elem("h3",{"class":group+" accordion-header"},title),submenu=wb.elem("div",{"class":"submenu block-menu accordion-body"}),blockmenu=document.querySelector("#block_menu");blockmenu.appendChild(header),blockmenu.appendChild(submenu)}specs.forEach(function(spec){spec.group=group,spec.isTemplateBlock=!0,submenu.appendChild(wb.Block(spec))})}Event.on(".tabbar","click",".chrome_tab",tabSelect),Event.on("#block_menu","click",".accordion-header",accordion),wb.showWorkspace=showWorkspace,window.updateScriptsView=updateScriptsView,wb.menu=function(blockspec){var title=blockspec.name.replace(/\W/g,""),specs=blockspec.blocks;switch(wb.view){case"result":return run_menu(title,specs);case"blocks":return edit_menu(title,specs);case"editor":return edit_menu(title,specs);default:return edit_menu(title,specs)}},"result"===wb.view&&Event.once(document.body,"wb-script-loaded",null,runCurrentScripts)}(wb),function(wb){function clearScripts(event,force){(force||confirm("Throw out the current script?"))&&(document.querySelector(".workspace > .scripts_workspace").remove(),createWorkspace("Workspace"),document.querySelector(".workspace > .scripts_text_view").innerHTML="")}function saveCurrentScripts(){wb.showWorkspace("block"),document.querySelector("#block_menu").scrollIntoView(),localStorage["__"+language+"_current_scripts"]=scriptsToString()}function scriptsToString(title,description){title||(title=""),description||(description="");var blocks=wb.findAll(document.body,".workspace .scripts_workspace");return JSON.stringify({title:title,description:description,date:Date.now(),waterbearVersion:"2.0",blocks:blocks.map(wb.blockDesc)})}function createDownloadUrl(evt){window.webkitURL||window.URL;var file=new Blob([scriptsToString()],{type:"application/json"}),reader=new FileReader,a=document.createElement("a");reader.onloadend=function(){a.href=reader.result,a.download="script.json",a.target="_blank",document.body.appendChild(a),a.click()},reader.readAsDataURL(file),evt.preventDefault()}function comingSoon(){alert("Restore will be working again soon. You can drag saved json files to the script workspace now.")}function loadScriptsFromObject(fileObject){if(!fileObject)return createWorkspace();var blocks=fileObject.blocks.map(wb.Block);return blocks.length?(blocks.length>1&&(console.log("not really expecting multiple blocks here right now"),console.log(blocks)),blocks.forEach(function(block){wireUpWorkspace(block),Event.trigger(block,"wb-add")}),wb.loaded=!0,Event.trigger(document.body,"wb-script-loaded"),void 0):createWorkspace()}function loadScriptsFromGist(gist){var file,keys=Object.keys(gist.data.files);return keys.forEach(function(key){/.*\.json/.test(key)&&(file=gist.data.files[key].content)}),file?(loadScriptsFromObject(JSON.parse(file)),void 0):(console.log("no json file found in gist: %o",gist),void 0)}function runScriptFromGist(gist){console.log("running script from gist");var file,keys=Object.keys(gist.data.files);return keys.forEach(function(key){/.*\.js$/.test(key)&&(console.log("found javascript file: %s",key),file=gist.data.files[key].content)}),file?(wb.runScript(file),void 0):(console.log("no javascript file found in gist: %o",gist),void 0)}function createWorkspace(name){var id=uuid(),workspace=wb.Block({group:"scripts_workspace",id:id,scriptId:id,scopeId:id,blocktype:"context",sockets:[{name:name}],script:"[[1]]",isTemplateBlock:!1,help:"Drag your script blocks here"});wireUpWorkspace(workspace)}function wireUpWorkspace(workspace){workspace.addEventListener("drop",getFiles,!1),workspace.addEventListener("dragover",function(evt){evt.preventDefault()},!1),wb.findAll(document,".scripts_workspace").forEach(function(ws){ws.parentElement.removeChild(ws)}),document.querySelector(".workspace").appendChild(workspace),workspace.querySelector(".contained").appendChild(wb.elem("div",{"class":"dropCursor"})),wb.initializeDragHandlers()}function getFiles(evt){evt.stopPropagation(),evt.preventDefault();var files=evt.dataTransfer.files;if(files.length>0){var file=files[0];if(-1===file.type.indexOf("json"))return;var reader=new FileReader;reader.readAsText(file),reader.onload=function(evt){clearScripts(null,!0);var saved=JSON.parse(evt.target.result);loadScriptsFromObject(saved)}}}var language=location.pathname.match(/\/(.*)\.html/)[1];Event.on(".clearScripts","click",null,clearScripts),Event.on(".editScript","click",null,function(){document.body.className="editor",wb.loadCurrentScripts(wb.queryParams)}),Event.on(".goto_stage","click",null,function(){document.body.className="result"}),window.onunload=saveCurrentScripts,Event.on(".save_scripts","click",null,createDownloadUrl),Event.on(".restore_scripts","click",null,comingSoon),wb.loaded=!1,wb.loadCurrentScripts=function(queryParsed){if(!wb.loaded){if(queryParsed.gist)wb.jsonp("https://api.github.com/gists/"+queryParsed.gist,loadScriptsFromGist);else if(localStorage["__"+language+"_current_scripts"]){var fileObject=JSON.parse(localStorage["__"+language+"_current_scripts"]);fileObject&&loadScriptsFromObject(fileObject)}else createWorkspace("Workspace");wb.loaded=!0}Event.trigger(document.body,"wb-loaded")},wb.runCurrentScripts=function(queryParsed){if(queryParsed.gist)wp.json("https://api.github.com/gists/"+queryParsed.gist,runScriptFromGist);else if(localStorage["__"+language+"_current_scripts"]){var fileObject=localStorage["__"+language+"_current_scripts"];fileObject&&wb.runScript(fileObject)}},wb.createWorkspace=createWorkspace,Event.on(".workspace","click",".disclosure",function(evt){var block=wb.closest(evt.wbTarget,".block");block.dataset.closed?delete block.dataset.closed:block.dataset.closed=!0}),Event.on(".workspace","dblclick",".locals .name",wb.changeName),Event.on(".workspace","keypress","input",wb.resize),Event.on(document.body,"wb-loaded",null,function(){console.log("loaded")}),Event.on(document.body,"wb-script-loaded",null,function(){console.log("script loaded")})}(wb),wb.wrap=function(script){return"try{"+script+"}catch(e){console,log(e);}})()"},Event.on(".runScripts","click",null,runCurrentScripts),wb.runScript=function(script){wb.script=script;var runtimeUrl=location.protocol+"//"+location.host+"/dist/javascript_runtime.min.js";console.log("trying to load library %s",runtimeUrl),document.querySelector(".stageframe").contentWindow.postMessage(JSON.stringify({command:"loadlibrary",library:runtimeUrl,script:wb.wrap(script)}),"*")},Event.on(".clear_canvas","click",null,clearStage),Event.on(".editScript","click",null,clearStage),wb.prettyScript=function(elements){var script=js_beautify(elements.map(function(elem){return wb.codeFromBlock(elem)}).join(""));return script="var Minecraft = require('./minecraft-pi/lib/minecraft.js'); \n var client = new Minecraft('localhost', 4711, function() {\nvar zeros={x:0, y:0, z:0};\n"+script+"\n});"},wb.writeScript=function(elements,view){view.innerHTML='<pre class="language-javascript">'+wb.prettyScript(elements)+"</pre>",hljs.highlightBlock(view.firstChild)},wb.choiceLists={"boolean":["true","false"],blocktypes:["step","expression","context","eventhandler"],types:["string","number","boolean","array","object","function","any"],rettypes:["none","string","number","boolean","array","object","function","any"]},Event.on(".socket input","click",null,function(event){event.wbTarget.focus(),event.wbTarget.select()
}),wb.choiceLists.types=wb.choiceLists.types.concat(["position"]),wb.choiceLists.rettypes=wb.choiceLists.rettypes.concat(["position"]),wb.choiceLists.blocks=["AIR","STONE","GRASS","DIRT","COBBLESTONE","WOOD_PLANKS","SAPLING","BEDROCK","WATER_FLOWING","WATER_STATIONARY","LAVA_FLOWING","LAVA_STATIONARY","SAND","GRAVEL","GOLD_ORE","IRON_ORE","COAL_ORE","WOOD","LEAVES","GLASS","LAPIS_LAZULI_ORE","LAPIS_LAZULI_BLOCK","SANDSTONE","BED","COBWEB","GRASS_TALL","WOOL","FLOWER_YELLOW","FLOWER_CYAN","MUSHROOM_BROWN","MUSHROOM_RED","GOLD_BLOCK","IRON_BLOCK","STONE_SLAB_DOUBLE","STONE_SLAB","BRICK_BLOCK","TNT","BOOKSHELF","MOSS_STONE","OBSIDIAN","TORCH","FIRE","STAIRS_WOOD","CHEST","DIAMOND_ORE","DIAMOND_BLOCK","CRAFTING_TABLE","FARMLAND","FURNACE_INACTIVE","FURNACE_ACTIVE","DOOR_WOOD","LADDER","STAIRS_COBBLESTONE","DOOR_IRON","REDSTONE_ORE","SNOW","ICE","SNOW_BLOCK","CACTUS","CLAY","SUGAR_CANE","FENCE","GLOWSTONE_BLOCK","BEDROCK_INVISIBLE","GLASS_PANE","MELON","FENCE_GATE","GLOWING_OBSIDIAN","NETHER_REACTOR_CORE"],wb.choiceLists.types=wb.choiceLists.types.concat(["block"]),wb.choiceLists.rettypes=wb.choiceLists.rettypes.concat(["block"]),wb.choiceLists.cameramode=["normal","thirdPerson","fixed"],wb.menu({name:"Control",blocks:[{blocktype:"eventhandler",id:"1cf8132a-4996-47db-b482-4e336200e3ca",script:"function _start(){[[1]]}_start();",help:"this trigger will run its scripts once when the program starts",sockets:[{name:"when program runs"}]},{blocktype:"eventhandler",id:"cfea9087-3d7c-46ad-aa41-579bba2f4709",locals:[{blocktype:"expression",sockets:[{name:"count##"}],script:"local.count##",type:"number"}],script:"local.count##=0;(function(){setInterval(function(){local.count##++;[[1]]},1000/{{1}})})();",help:"this trigger will run the attached blocks periodically",sockets:[{name:"repeat",type:"number",value:"30"},{name:"times a second"}]},{blocktype:"step",id:"079b2b89-41c2-4d00-8e21-bcb86574bf80",script:"local.variable## = {{1}};",locals:[{blocktype:"expression",script:"local.variable##",type:"any",sockets:[{name:"variable##"}]}],help:"create a reference to re-use the any",sockets:[{name:"variable",type:"any",value:null}]},{blocktype:"step",id:"b4036693-8645-4852-a4de-9e96565f9aec",script:"{{1}} = {{2}};",help:"first argument must be a variable",sockets:[{name:"set variable",type:"any",value:null},{name:"to",type:"any",value:null}]},{blocktype:"context",id:"66b33236-c9ce-4b6c-9b69-e8c4fdadbf52",script:"setTimeout(function(){[[1]]},1000*{{1}});",help:"pause before running the following blocks",sockets:[{name:"wait",type:"number",value:"1"},{name:"secs"}]},{blocktype:"context",id:"aa146082-9a9c-4ae7-a409-a89e84dc113a",script:"range({{1}}).forEach(function(idx, item){local.count## = idx;[[1]]});",help:"repeat the contained blocks so many times",locals:[{blocktype:"expression",sockets:[{name:"count##"}],script:"local.count##",type:"number"}],sockets:[{name:"repeat",type:"number",value:"10"}]},{blocktype:"step",id:"b7079d91-f76d-41cc-a6aa-43fc2749429c",script:'global.stage.dispatchEvent(new CustomEvent("wb_" + {{1}}));',help:"send this message to any listeners",sockets:[{name:"broadcast",type:"string",value:"ack"},{name:"message"}]},{blocktype:"step",id:"d175bd7d-c7fd-4465-8b1f-c82687f35577",script:'global.stage.dispatchEvent(new CustomEvent("wb_" + {{1}}, {detail: {{2}}}));',help:"send this message with an object argument to any listeners",sockets:[{name:"broadcast",type:"string",value:"ping"},{name:"message with data",type:"any",value:null}]},{blocktype:"eventhandler",id:"3931a20c-f510-45e4-83d2-4005983d5cae",script:'global.stage.addEventListener("wb_" + {{1}}, function(){[[1]]});',help:"add a listener for the given message, run these blocks when it is received",sockets:[{name:"when I receive",type:"string",value:"ack"},{name:"message"}]},{blocktype:"eventhandler",id:"a0496339-c405-4d1c-8185-9bc211bf5a56",script:'global.stage.addEventListener("wb_" + {{1}}, function(event){local.data##=event.detail;[[1]]});',locals:[{blocktype:"expression",sockets:[{name:"data##"}],script:"local.data##",type:"any"}],help:"add a listener for the given message which receives data, run these blocks when it is received",sockets:[{name:"when I receive",type:"string",value:"ping"},{name:"message with data"}]},{blocktype:"context",id:"b1e43170-800a-4e9b-af82-0ed5c62c47a0",script:"while({{1}}){[[1]]}",help:"repeat until the condition is false",sockets:[{name:"forever if",type:"boolean",value:"false"}]},{blocktype:"context",id:"20ba3e08-74c0-428e-b612-53545de63ce0",script:"if({{1}}){[[1]]}",help:"run the following blocks only if the condition is true",sockets:[{name:"if",type:"boolean",value:null}]},{blocktype:"context",id:"6dddaf61-caf0-4976-a3f1-9d9c3bbbf5a4",script:"if( ! {{1}} ){ [[1]]} }",help:"run the  blocks if the condition is not true",sockets:[{name:"if not",type:"boolean",value:null}]},{blocktype:"context",id:"5a09e58a-4f45-4fa8-af98-84de735d0fc8",script:"while(!({{1}})){[[1]]}",help:"repeat forever until condition is true",sockets:[{name:"repeat until",type:"boolean",value:null}]}]}),wb.menu({name:"Game",blocks:[{blocktype:"step",sockets:[{name:"say"},{type:"string",value:"hi"},{name:"in chat"}],script:"client.chat({{1}});",help:"send a message as chat"},{blocktype:"step",sockets:[{name:"Save Checkpoint"}],script:"client.saveCheckpoint();",help:"Save Checkpoint"},{blocktype:"step",sockets:[{name:"Restore Checkpoint"}],script:"client.restoreCheckpoint();",help:"Restore Last Checkpoint"}]}),wb.menu({name:"Player",blocks:[{blocktype:"context",id:"fe8f0ff3-1f52-4866-bbf0-bc3c7a850e11",sockets:[{name:"Get Player Tile Position"}],script:'client.getTile(function(data){console.log("data =", data); var aData = data.toString().trim().split(","); console.log("aData =", aData); var playerPos = {x:parseInt(aData[0],10), y: parseInt(aData[1],10), z: parseInt(aData[2],10)}; [[1]]  client.end();});',locals:[{blocktype:"expression",sockets:[{name:"playerPos"}],script:"playerPos",type:"position"},{blocktype:"expression",sockets:[{name:"playerPos as text"}],script:'"x:"+playerPos.x.toString()+", y:"+playerPos.y.toString()+", z:"+playerPos.z.toString()',type:"string"}],help:"get the tile that the player is on"},{blocktype:"step",id:"5474d53a-b671-4392-b299-d10339ad12af",sockets:[{name:"Create Position##"},{name:"from Player offset by"},{name:"Position",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"}],script:"var pos## = {x:(playerPos.x+{{1}}.x), y:(playerPos.y+{{1}}.x) , z:(playerPos.z+{{1}}.x)};",locals:[{blocktype:"expression",sockets:[{name:"Position ##"}],script:"pos##",type:"position"}],help:"create new position relative to Player position"},{blocktype:"step",id:"0ff6e19b-74ee-415e-805a-c46cd2e6ee6e",sockets:[{name:"move Player to"},{name:"Position",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"}],script:"client.setTile({{1}}.x, {{1}}.y, {{1}}.z);",help:"move Player to x, y, z of position"}]}),wb.menu({name:"Position",blocks:[{blocktype:"expression",id:"8bb6aab6-273d-4671-8caa-9c15b5c486a7",sockets:[{name:"Position"},{name:"x",type:"number",value:"0"},{name:"y",type:"number",value:"0"},{name:"z",type:"number",value:"0"}],type:"position",script:"{x:{{1}}, y:{{2}} , z:{{3}}}",help:"position"},{blocktype:"expression",id:"590c8aef-a755-4df5-8930-b430db5a3c3d",sockets:[{name:"Centre"}],type:"position",script:"zeros",help:"position"},{blocktype:"expression",id:"ad36ae75-3655-4226-a759-312487bc48d9",sockets:[{name:"Position1",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"},{name:"add"},{name:"Position2",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"}],script:"{x:({{1}}.x+{{2}}.x), y:({{1}}.y+{{2}}.y) , z:({{1}}.z+{{2}}.z)}",type:"position",help:"add 2 positions"},{blocktype:"step",id:"1a18abe9-0c1e-42e6-a530-b99fc85900fd",sockets:[{name:"Create"},{name:"Position##",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"}],script:"var pos## = {{1}};",locals:[{blocktype:"expression",sockets:[{name:"Position##"}],script:"pos##",type:"position"}],help:"create new named position"},{blocktype:"step",id:"353d8095-32e3-443f-92dc-4e10a0ba7f28",sockets:[{name:"create new named numbers from"},{name:"Position",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"}],script:"var pos## = {{1}};",locals:[{blocktype:"expression",sockets:[{name:"x##"}],script:"pos##.x",type:"number"},{blocktype:"expression",sockets:[{name:"y##"}],script:"pos##.y",type:"number"},{blocktype:"expression",sockets:[{name:"z##"}],script:"pos##.z",type:"number"}],help:"get parts of position"},{blocktype:"step",id:"bdd6ec2f-bcf0-454c-8d8b-1e5361922af0",sockets:[{name:"Create pos##"},{name:"Position1",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"},{name:"add"},{name:"Position2",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"}],script:"var pos## = {x:({{1}}.x+{{2}}.x), y:({{1}}.y+{{2}}.y) , z:({{1}}.z+{{2}}.z)};",locals:[{blocktype:"expression",sockets:[{name:"Pos##"}],script:"pos##",type:"position"}],help:"create new position by adding 2 others"},{blocktype:"expression",id:"3fa57ab7-bfed-4d36-8307-0ba11eda25f0",sockets:[{name:"Position",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"},{name:"as text"}],script:'"x:"+{{1}}.x.toString()+", "y":"+{{1}}.y.toString()+", "z":"+{{1}}.z.toString()',type:"string",help:"Position as text"}]}),wb.menu({name:"Blocks",id:"63b8ffcc-9b51-4a5e-b687-634945bfb9b8",blocks:[{blocktype:"context",sockets:[{name:"get Block Type at "},{name:"Position",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"}],script:"client.getBlock({{1}}.x, {{1}}.y, {{1}}.z, function(block##){[[1]]  client.end()});",locals:[{blocktype:"expression",sockets:[{name:"block##"}],script:"parseInt(block##)",type:"block"}],help:"get block type at x, y, z"},{blocktype:"step",id:"5ac8754e-6bbe-42a8-8504-707f1ca3848b",sockets:[{name:"set Block at"},{name:"Position",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"},{name:"to"},{type:"choice",options:"blocks",value:"choice"}],script:"client.setBlock({{1}}.x, {{1}}.y, {{1}}.z, client.blocks[{{2}}]);",help:"set block at position"},{blocktype:"step",id:"3969a128-5e8d-4320-9f91-73bebf81820f",labels:["set Blocks between [object] and [object] to [choice:blocks:STONE]"],sockets:[{name:"set Blocks between"},{name:"Position1",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"},{name:"and"},{name:"Position2",type:"position",block:"8bb6aab6-273d-4671-8caa-9c15b5c486a7"},{name:"to"},{type:"choice",options:"blocks",value:"choice"}],script:"client.setBlocks({{1}}.x, {{1}}.y, {{1}}.z, {{2}}.x, {{2}}.y, {{2}}.z, client.blocks[{{3}}]);",help:"set blocks in a 3D rectangle between the first and second positions to .."},{blocktype:"expression",id:"7ab673d1-832b-4a0b-9dc9-0ac47892893b",sockets:[{name:"block type name"},{type:"number",value:"0"}],script:"Object.keys(client.blocks).filter(function(element){return (client.blocks[element] === {{1}});})",type:"number",help:"name of a blocktype by number"},{blocktype:"context",id:"2ab7b0ea-b646-4672-a2fe-310542b924aa",sockets:[{name:"get height at "},{type:"number",value:"0"},{type:"number",value:"0"}],script:"client.getHeight({{1}}, {{2}}, function(height##){[[1]]  client.end()});",locals:[{blocktype:"expression",sockets:[{name:"height##"}],script:"parseInt(height##)",type:"number"}],help:"get height of blocks at x, y"}]}),wb.menu({name:"Camera",blocks:[{blocktype:"step",id:"87a5c7ab-8381-4e9b-8038-fbb6e9b787a4",sockets:[{name:"set camera mode to"},{type:"choice",options:"cameramode",value:"choice"}],script:"client.setCameraMode({{1}});",help:"set camera mode"},{blocktype:"step",id:"aa7f5980-fe60-41cc-94e0-094eb7df7043",sockets:[{name:"set camera position to"},{type:"position"}],script:"client.setCameraPosition({{1}}.x, {{1}}.y, {{1}}.z);",help:"set camera position to a position"}]}),wb.menu({name:"Arrays",blocks:[{blocktype:"step",id:"e6a297e9-1255-4701-91d8-80548489ee9a",script:"local.array## = [];",help:"Create an empty array",locals:[{blocktype:"expression",sockets:[{name:"array##"}],script:"local.array##",type:"array"}],sockets:[{name:"new array##"}]},{blocktype:"step",id:"83d67170-4ba7-45ac-95ae-bb2f314c3ae0",script:"local.array## = {{1}}.slice();",help:"create a new array with the contents of another array",locals:[{blocktype:"expression",sockets:[{name:"array##"}],script:"local.array##",type:"array"}],sockets:[{name:"new array with array##",type:"array",value:null}]},{blocktype:"expression",id:"3e56f9c1-29b9-4d0c-99bd-05ccabfa29c2",script:"{{1}}[{{2}}]",type:"any",help:"get an item from an index in the array",sockets:[{name:"array",type:"array",value:null},{name:"item",type:"number",value:"0"}]},{blocktype:"expression",id:"5b1cc330-b9b1-4062-b8d4-e5032c7a5776",script:"{{1}}.join({{2}})",type:"string",help:"join items of an array into a string, each item separated by given string",sockets:[{name:"array",type:"array",value:null},{name:"join with",type:"string",value:", "}]},{blocktype:"step",id:"3fab2b88-430a-401e-88b2-2703d614780a",script:"{{1}}.push({{2}});",help:"add any object to an array",sockets:[{name:"array",type:"array",value:null},{name:"append",type:"any",value:null}]},{blocktype:"expression",id:"bf3ed213-4435-4152-bb2c-573ce1721036",script:"{{1}}.length",type:"number",help:"get the length of an array",sockets:[{name:"array",type:"array",value:null},{name:"length"}]},{blocktype:"expression",id:"f4870f0f-1dbb-4bc7-b8e3-3a00af613689",script:"{{1}}.splice({{2}}, 1)[0]",type:"any",help:"remove item at index from an array",sockets:[{name:"array",type:"array",value:null},{name:"remove item",type:"number",value:"0"}]},{blocktype:"expression",id:"e137e1a3-fe66-4d15-ae2a-596050acb6a7",script:"{{1}}.pop()",type:"any",help:"remove and return the last item from an array",sockets:[{name:"array",type:"array",value:null},{name:"pop"}]},{blocktype:"expression",id:"00685267-c279-4fc1-bdbd-a07742a76b1e",script:"{{1}}.shift()",type:"any",help:"remove and return the first item from an array",sockets:[{name:"array",type:"array",value:null},{name:"shift"}]},{blocktype:"expression",id:"b4f115d3-fc52-4d75-a363-5119de21e97c",script:"{{1}}.slice().reverse()",type:"array",help:"reverse a copy of array",sockets:[{name:"array",type:"array",value:null},{name:"reversed"}]},{blocktype:"expression",id:"0931d219-707c-41dd-92e6-b1a7c2a0f6b3",script:"{{1}}.concat({{2}});",type:"array",help:"a new array formed by joining the arrays",sockets:[{name:"array",type:"array",value:null},{name:"concat",type:"array",value:null}]},{blocktype:"context",id:"9f6f4e21-7abf-4e6f-b9bf-4ce8a1086a21",script:"{{1}}.forEach(function(item, idx){local.index = idx; local.item = item; [[1]] });",locals:[{blocktype:"expression",sockets:[{name:"index"}],script:"local.index",help:"index of current item in array",type:"number"},{blocktype:"expression",sockets:[{name:"item"}],script:"local.item",help:"the current item in the iteration",type:"any"}],help:"run the blocks with each item of a named array",sockets:[{name:"array",type:"array",value:null},{name:"for each"}]}]}),wb.menu({name:"Boolean",blocks:[{blocktype:"expression",id:"770756e8-3a10-4993-b02e-3d1333c98958",type:"boolean",script:"({{1}} && {{2}})",help:"both operands are true",sockets:[{name:"",type:"boolean",value:null},{name:"and",type:"boolean",value:null}]},{blocktype:"expression",id:"a56c0d03-5c5c-4459-9aaf-cbbea6eb3abf",type:"boolean",script:"({{1}} || {{2}})",help:"either or both operands are true",sockets:[{name:"",type:"boolean",value:null},{name:"or",type:"boolean",value:null}]},{blocktype:"expression",id:"cb9ddee8-5ee1-423b-9559-6d2cbb379b80",type:"boolean",script:"({{1}} ? !{{2}} : {{2}})",help:"either, but not both, operands are true",sockets:[{name:"",type:"boolean",value:null},{name:"xor",type:"boolean",value:null}]},{blocktype:"expression",id:"138a6840-37cc-4e2d-b44a-af32e673ba56",type:"boolean",script:"(! {{1}})",help:"operand is false",sockets:[{name:"not",type:"boolean",value:null}]}]}),wb.menu({name:"Math",blocks:[{blocktype:"expression",id:"406d4e12-7dbd-4f94-9b0e-e2a66d960b3c",type:"number",script:"({{1}} + {{2}})",help:"sum of the two operands",sockets:[{name:"",type:"number",value:"0"},{name:"+",type:"number",value:"0"}]},{blocktype:"expression",id:"d7082309-9f02-4cf9-bcd5-d0cac243bff9",type:"number",script:"({{1}} - {{2}})",help:"difference of the two operands",sockets:[{name:"",type:"number",value:"0"},{name:"-",type:"number",value:"0"}]},{blocktype:"expression",id:"bd3879e6-e440-49cb-b10b-52d744846341",type:"number",script:"({{1}} * {{2}})",help:"product of the two operands",sockets:[{name:"",type:"number",value:"0"},{name:"*",type:"number",value:"0"}]},{blocktype:"expression",id:"7f51bf70-a48d-4fda-ab61-442a0766abc4",type:"number",script:"({{1}} / {{2}})",help:"quotient of the two operands",sockets:[{name:"",type:"number",value:"0"},{name:"/",type:"number",value:"0"}]},{blocktype:"expression",id:"e3a5ea20-3ca9-42cf-ac02-77ff06836a7e",type:"boolean",script:"({{1}} === {{2}})",help:"two operands are equal",sockets:[{name:"",type:"number",value:"0"},{name:"=",type:"number",value:"0"}]},{blocktype:"expression",id:"d753757b-a7d4-4d84-99f1-cb9b8c7e62da",type:"boolean",script:"({{1}} < {{2}})",help:"first operand is less than second operand",sockets:[{name:"",type:"number",value:"0"},{name:"<",type:"number",value:"0"}]},{blocktype:"expression",id:"5a1f5f68-d74b-4154-b376-6a0200f585ed",type:"boolean",script:"({{1}} > {{2}})",help:"first operand is greater than second operand",sockets:[{name:"",type:"number",value:"0"},{name:">",type:"number",value:"0"}]},{blocktype:"expression",id:"a35fb291-e2fa-42bb-a5a6-2124bb33157d",type:"number",script:"randint({{1}}, {{2}})",help:"random number between two numbers (inclusive)",sockets:[{name:"pick random",type:"number",value:"1"},{name:"to",type:"number",value:"10"}]},{blocktype:"expression",id:"a2647515-2f14-4d0f-84b1-a6e288823630",type:"number",script:"({{1}} % {{2}})",help:"modulus of a number is the remainder after whole number division",sockets:[{name:"",type:"number",value:"0"},{name:"mod",type:"number",value:"0"}]},{blocktype:"expression",id:"4f7803c0-24b1-4a0c-a461-d46acfe9ab25",type:"number",script:"Math.round({{1}})",help:"rounds to the nearest whole number",sockets:[{name:"round",type:"number",value:"0"}]},{blocktype:"expression",id:"c38383df-a765-422e-b215-7d1cfb7557a1",type:"number",script:"Math.abs({{1}})",help:"converts a negative number to positive, leaves positive alone",sockets:[{name:"absolute of",type:"number",value:"10"}]},{blocktype:"expression",id:"9bf66bb0-c182-42e5-b3a7-cf10de26b08c",type:"number",script:"rad2deg(Math.acos({{1}}))",help:"inverse of cosine",sockets:[{name:"arccosine degrees of",type:"number",value:"10"}]},{blocktype:"expression",id:"92f79a75-e3f4-4fc7-8f17-bf586aef180b",type:"number",script:"rad2deg(Math.asin({{1}}))",help:"inverse of sine",sockets:[{name:"arcsine degrees of",type:"number",value:"10"}]},{blocktype:"expression",id:"1f5ee069-148e-4e4a-a514-5179af86be15",type:"number",script:"rad2deg(Math.atan({{1}}))",help:"inverse of tangent",sockets:[{name:"arctangent degrees of",type:"number",value:"10"}]},{blocktype:"expression",id:"46bcac2d-eb76-417c-81af-cb894a54a86c",type:"number",script:"Math.ceil({{1}})",help:"rounds up to nearest whole number",sockets:[{name:"ceiling of",type:"number",value:"10"}]},{blocktype:"expression",id:"ce4bf2bc-a06a-47f4-ac05-df2213d087a5",type:"number",script:"Math.cos(deg2rad({{1}}))",help:"ratio of the length of the adjacent side to the length of the hypotenuse",sockets:[{name:"cosine of",type:"number",value:"10"},{name:"degrees"}]},{blocktype:"expression",id:"1a8f6a28-14e9-4400-8e80-31217309ebc9",type:"number",script:"Math.sin(deg2rad({{1}}))",help:"ratio of the length of the opposite side to the length of the hypotenuse",sockets:[{name:"sine of",type:"number",value:"10"},{name:"degrees"}]},{blocktype:"expression",id:"fcecb61b-7fd9-4a92-b6cb-77d0a2fc8541",type:"number",script:"Math.tan(deg2rad({{1}}))",help:"ratio of the length of the opposite side to the length of the adjacent side",sockets:[{name:"tangent of",type:"number",value:"10"},{name:"degrees"}]},{blocktype:"expression",id:"8a4a81d8-de25-46f0-b610-97d4f6fffbff",type:"number",script:"Math.pow({{1}}, {{2}})",help:"multiply a number by itself the given number of times",sockets:[{name:"",type:"number",value:"10"},{name:"to the power of",type:"number",value:"2"}]},{blocktype:"expression",id:"668798a3-f15e-4839-b4b3-da5db380aa5a",type:"number",script:"Math.sqrt({{1}})",help:"the square root is the same as taking the to the power of 1/2",sockets:[{name:"square root of",type:"number",value:"10"}]},{blocktype:"expression",id:"a34c51d9-bfa0-49ad-8e7d-b653611836d3",script:"Math.PI;",type:"number",help:"pi is the ratio of a circle's circumference to its diameter",sockets:[{name:"pi"}]},{blocktype:"expression",id:"da2c8203-bf80-4617-a762-92dd4d7bfa27",script:"Math.PI * 2",type:"number",help:"tau is 2 times pi, a generally more useful number",sockets:[{name:"tau"}]}]}),wb.menu({name:"Objects",blocks:[{blocktype:"step",id:"26ee5e5c-5405-453f-8941-26ac6ea009ec",script:"local.object## = {};",locals:[{blocktype:"expression",sockets:[{name:"object##"}],script:"local.object##",type:"object"}],help:"create a new, empty object",sockets:[{name:"new object##"}]},{blocktype:"step",id:"ee86bcd0-10e3-499f-9a81-6738374c0c1f",script:"{{1}}[{{2}}] = {{3}};",help:"set the key/value of an object",sockets:[{name:"object",type:"any",value:null},{name:"key",type:"string",value:null},{name:"= value",type:"any",value:null}]},{blocktype:"expression",id:"7ca6df56-7c25-4c8c-98ef-8dfef90eff36",script:"{{1}}[{{2}}]",type:"any",help:"return the value of the key in an object",sockets:[{name:"object",type:"any",value:null},{name:"value at key",type:"string",value:null}]},{blocktype:"context",id:"322da80d-d8e2-4261-bab7-6ff0ae89e5f4",script:"Object.keys({{1}}).forEach(function(key){local.key = key; local.item = {{1}}[key]; [[1]] });",locals:[{blocktype:"expression",sockets:[{name:"key"}],script:"local.key",help:"key of current item in object",type:"string"},{blocktype:"expression",sockets:[{name:"item"}],script:"local.item",help:"the current item in the iteration",type:"any"}],help:"run the blocks with each item of a object",sockets:[{name:"for each item in",type:"any",value:null},{name:"do"}]}]}),wb.menu({name:"Strings",blocks:[{blocktype:"expression",id:"cdf5fa88-0d87-45d1-bf02-9ee4ec4c5565",script:"{{1}}.split({{2}})",type:"array",help:"create an array by splitting the named string on the given string",sockets:[{name:"string",type:"string",value:null},{name:"split on",type:"string",value:null}]},{blocktype:"expression",id:"e1951d04-dc2f-459e-9d7a-4796f29169ea",type:"string",script:"({{1}} + {{2}})",help:"returns a string by joining together two strings",sockets:[{name:"concatenate",type:"string",value:"hello"},{name:"with",type:"string",value:"world"}]},{blocktype:"expression",id:"e71d4b0b-f32e-4b02-aa9d-5cbe76a8abcb",script:"{{1}}[{{2}}]",type:"string",help:"get the single character string at the given index of named string",sockets:[{name:"string",type:"string",value:null},{name:"character at",type:"number",value:"0"}]},{blocktype:"expression",id:"c1eda8ae-b77c-4f5f-9b9f-c11b65235765",script:"{{1}}.length",type:"number",help:"get the length of named string",sockets:[{name:"string",type:"string",value:null},{name:"length"}]},{blocktype:"expression",id:"cc005f19-e1b9-4f74-8fd0-91faccedd370",script:"{{1}}.indexOf({{2}})",type:"number",help:"get the index of the substring within the named string",sockets:[{name:"string",type:"string",value:null},{name:"indexOf",type:"string",value:null}]},{blocktype:"expression",id:"8b536c13-4c56-471e-83ac-cf8648602df4",script:"{{1}}.replace({{2}}, {{3}})",type:"string",help:"get a new string by replacing a substring with a new string",sockets:[{name:"string",type:"string",value:null},{name:"replace",type:"string",value:null},{name:"with",type:"string",value:null}]},{blocktype:"expression",id:"8eaacf8a-18eb-4f21-a1ab-a356326f7eae",script:"{{1}}.toString()",type:"string",help:"convert any object to a string",sockets:[{name:"to string",type:"any",value:null}]},{blocktype:"step",id:"48bb8639-0092-4384-b5a0-3a772699dea9",script:"// {{1}};\n",help:"this is a comment and will not be run by the program",sockets:[{name:"comment",type:"string",value:null}]},{blocktype:"step",id:"2f178d61-e619-47d0-b9cf-fcb52625c2a3",script:"window.alert({{1}});",help:"pop up an alert window with string",sockets:[{name:"alert",type:"string",value:null}]},{blocktype:"step",id:"8496b7af-129f-48eb-b15b-8803b7617493",script:"console.log({{1}});",help:"Send any object as a message to the console",sockets:[{name:"console log",type:"any",value:null}]},{blocktype:"step",id:"8bfaf131-d169-4cf4-afe4-1d7f02a55341",script:"var __a={{2}};__a.unshift({{1}});console.log.apply(console, __a);",help:"send a message to the console with a format string and multiple objects",sockets:[{name:"console log format",type:"string",value:null},{name:"arguments",type:"array",value:null}]},{blocktype:"expression",id:"06ddcfee-76b7-4be4-856d-44cda3fb109b",script:"global.keys",help:"for debugging",type:"object",sockets:[{name:"global keys object"}]}]}),wb.view){case"editor":case"blocks":case"result":switchMode(wb.view);break;default:switchMode("editor")}