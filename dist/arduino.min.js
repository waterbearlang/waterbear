function hex(length){if(length>8)return hex(8)+hex(length-8);var myHex=Math.random().toString(16).slice(2,2+length);return pad(myHex,length)}function pad(str,length){for(;str.length<length;)str+="0";return str}function variant(){return"89ab"[Math.floor(4*Math.random())]}function isUuid(value){return UUID_TEST.test(value)}function uuid(){return hex(8)+"-"+hex(4)+"-4"+hex(3)+"-"+variant()+hex(3)+"-"+hex(12)}function switchMode(mode){var loader=document.querySelector("#block_menu_load");loader.parentElement.removeChild(loader),document.body.className=mode,wb.loadCurrentScripts(q)}var wb={};wb.urlToQueryParams=function(url){var qparts,qpart,qparams={},parts=(url||"").split("?"),i=0;if(parts.length<=1)return qparams;qparts=parts[1].split("&");for(i in qparts)qpart=qparts[i].split("="),qparams[decodeURIComponent(qpart[0])]=decodeURIComponent(qpart[1]||"");return qparams},wb.queryParamsToUrl=function(params){var base=location.href.split("?")[0],keys=Object.keys(params),parts=[];return keys.forEach(function(key){Array.isArray(params[key])?params[key].forEach(function(value){parts.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}):parts.push(encodeURIComponent(key)+"="+encodeURIComponent(params[key]))}),base+"?"+parts.join("&")};var q=wb.urlToQueryParams(location.href);wb.queryParams=q,wb.view=wb.queryParams.view||"editor",function(){wb.makeArray=function(arrayLike){return Array.prototype.slice.call(arrayLike)},wb.reposition=function(elem,position){elem.style.top=position.top+"px",elem.style.left=position.left+"px"},wb.hide=function(elem){elem.dataset.display=elem.style.display,elem.style.display="none"},wb.show=function(elem){elem.style.display=elem.dataset.display||"block",delete elem.dataset.display};var svgtext=document.querySelector("svg text");wb.resize=function(input){input.wbTarget&&(input=input.wbTarget),svgtext.textContent=input.value;var textbox=svgtext.getBBox();input.style.width=.7*textbox.width+25+"px"},wb.dist=function(p1,p2,m1,m2){return Math.sqrt(Math.pow(p1-m1,2)+Math.pow(p2-m2,2))},wb.overlapRect=function(r1,r2){if(r1.left>r2.right)return 0;if(r1.right<r2.left)return 0;if(r1.top>r2.bottom)return 0;if(r1.bottom<r2.top)return 0;var max=Math.max,min=Math.min;return(max(r1.left,r2.left)-min(r1.right,r2.right))*(max(r1.top,r2.top)-min(r1.bottom,r2.bottom))},wb.rect=function(elem){return elem.getBoundingClientRect()},wb.overlap=function(elem1,elem2){return wb.overlapRect(wb.rect(elem1),wb.rect(elem2))},wb.area=function(elem){return elem.clientWidth*elem.clientHeight},wb.containedBy=function(target,container){var targetArea=Math.min(wb.area(target),.9*wb.area(container));return target.overlap(container)>=targetArea},wb.closest=function(elem,selector){for(elem.jquery&&(elem=elem[0]);elem;){if(wb.matches(elem,selector))return elem;if(!elem.parentElement)throw new Error("Element has no parent, is it in the tree? %o",elem);elem=elem.parentElement}return null},wb.indexOf=function(elem){for(var idx=0;elem.previousSiblingElement;)elem=elem.previousSiblingElement,idx++;return idx},wb.find=function(elem,selector){return elem.querySelector(selector)},wb.findAll=function(elem,selector){return wb.makeArray(elem.querySelectorAll(selector))},wb.findChildren=function(elem,selector){return wb.makeArray(elem.children).filter(function(item){return wb.matches(item,selector)})},wb.findChild=function(elem,selector){if(2!==arguments.length)throw new Exception("This is the culprit");for(var children=elem.children,i=0;i<children.length;i++){var child=children[i];if(wb.matches(child,selector))return child}return null},wb.elem=function elem(name,attributes,children){var e,val;return e=name.jquery?name[0]:name.nodeType?name:document.createElement(name),attributes&&Object.keys(attributes).forEach(function(key){null!==attributes[key]&&void 0!==attributes[key]&&("function"==typeof attributes[key]?(val=attributes[key](attributes),val&&e.setAttribute(key,val)):e.setAttribute(key,attributes[key]))}),children&&(Array.isArray(children)?children.forEach(function(child){child.nodeName?e.appendChild(child):Array.isArray(child)?(console.log("DEPRECATED array arg to elem: use sub-elem instead"),e.appendChild(elem(child[0],child[1],child[2]))):e.appendChild(document.createTextNode(child))}):children.nodeName?e.appendChild(children):e.appendChild(document.createTextNode(children))),e},document.body.matches?wb.matches=function(elem,selector){return wb.elem(elem).matches(selector)}:document.body.mozMatchesSelector?wb.matches=function(elem,selector){return wb.elem(elem).mozMatchesSelector(selector)}:document.body.webkitMatchesSelector?wb.matches=function(elem,selector){return wb.elem(elem).webkitMatchesSelector(selector)}:document.body.msMatchesSelector?wb.matches=function(elem,selector){return wb.elem(elem).msMatchesSelector(selector)}:document.body.oMatchesSelector&&(wb.matches=function(elem,selector){return wb.elem(elem).oMatchesSelector(selector)}),wb.jsonp=function(url,callback){var id="handler"+Math.floor(65535*Math.random()),handler=function(data){var script=document.getElementById(id);script.parentElement.removeChild(script),delete window[id],callback(data)};window[id]=handler,document.head.appendChild(wb.elem("script",{src:url+"?callback="+id,id:id}))}}(this),function(global){"use strict";var on=function on(elem,eventname,selector,handler){if("string"==typeof elem)return wb.makeArray(document.querySelectorAll(elem)).map(function(e){return on(e,eventname,selector,handler)});elem.tagName||console.error("first argument must be element"),"string"!=typeof eventname&&console.error("second argument must be eventname"),selector&&"string"!=typeof selector&&console.log("third argument must be selector or null"),"function"!=typeof handler&&console.log("fourth argument must be handler");var listener;return listener=selector?function(event){blend(event),event.wbValid&&(wb.matches(event.wbTarget,selector)?handler(event):wb.matches(event.wbTarget,selector+" *")&&(event.wbTarget=wb.closest(event.wbTarget,selector),handler(event)))}:function(event){blend(event),event.wbValid&&handler(event)},elem.addEventListener(eventname,listener,!1),listener},off=function(elem,eventname,handler){elem.removeEventListener(eventname,handler)},once=function(elem,eventname,selector,handler){var listener=function listener(event){handler(event),Event.off(elem,eventname,listener)};return Event.on(elem,eventname,selector,listener)},trigger=function(elemOrSelector,eventname,data){var elem;elem=elemOrSelector.nodeName?elemOrSelector:document.querySelector(elem);var evt=new CustomEvent(eventname,{bubbles:!0,cancelable:!0,detail:data});elem.dispatchEvent(evt)},isTouch="ontouchstart"in global,isPointerEvent=function(event){switch(event.type){case"touchstart":case"touchmove":case"touchend":case"tap":case"mousedown":case"mousemove":case"mouseup":case"click":return!0;default:return!1}},blend=function(event){if(isPointerEvent(event))if(isTouch){if(event.touches.length>1)return event;var touch=event.touches[0];event.wbTarget=touch.target,event.wbPageX=touch.pageX,event.wbPageY=touch.pageY,event.wbValid=!0}else{if(1!==event.which)return event;event.wbTarget=event.target,event.wbPageX=event.pageX,event.wbPageY=event.pageY,event.wbValid=!0}else event.wbTarget=event.target,event.wbValid=!0;return event};global.Event={on:on,off:off,once:once,trigger:trigger,isTouch:isTouch}}(this),function(){function dropCursor(){return _dropCursor||(_dropCursor=document.querySelector(".dropCursor")),_dropCursor}function reset(){dragTarget=null,potentialDropTargets=[],dropRects=[],dropTarget=null,startPosition=null,currentPosition=null,timer=null,dragging=!1,cloned=!1,scope=null}function initDrag(event){var eT=event.wbTarget;if(wb.matches(event.target,"input, select, option, .disclosure,.scripts_workspace")&&!wb.matches(eT,"#block_menu *"))return console.log("not a drag handle"),void 0;var target=wb.closest(eT,".block");return target?(dragTarget=target,target.parentElement.classList.contains("block-menu")&&(target.dataset.isTemplateBlock="true"),target.parentElement.classList.contains("local")&&(target.dataset.isLocal="true"),startPosition=wb.rect(target),wb.matches(target.parentElement,".scripts_workspace")||(startParent=target.parentElement),wb.matches(target,".step")&&(startIndex=wb.indexOf(target))):(console.log("not a valid drag target"),dragTarget=null),!1}function startDrag(event){if(!dragTarget)return void 0;if(dragTarget.classList.add("dragIndication"),currentPosition={left:event.wbPageX,top:event.wbPageY},dragTarget.dataset.isTemplateBlock){dragTarget.classList.remove("dragIndication");var parent=dragTarget.parentElement;dragTarget=wb.cloneBlock(dragTarget),dragTarget.classList.add("dragIndication"),scope=dragTarget.dataset.isLocal?wb.closest(parent,".context"):null,cloned=!0,wb.showWorkspace("block")}else Event.trigger(dragTarget,"wb-remove");return dragging=!0,dragTarget.style.position="absolute",document.querySelector(".content.editor").appendChild(dragTarget),cloned&&Event.trigger(dragTarget,"wb-clone"),wb.reposition(dragTarget,startPosition),potentialDropTargets=getPotentialDropTargets(dragTarget),dropRects=potentialDropTargets.map(function(elem){return elem.classList.add("dropTarget"),wb.rect(elem)}),timer=setTimeout(hitTest,dragTimeout),!1}function drag(event){if(!dragTarget)return void 0;currentPosition||startDrag(event),event.preventDefault();var nextPosition={left:event.wbPageX,top:event.wbPageY},dX=nextPosition.left-currentPosition.left,dY=nextPosition.top-currentPosition.top,currPos=wb.rect(dragTarget);if(wb.reposition(dragTarget,{left:currPos.left+dX,top:currPos.top+dY}),workspace){var container=workspace.parentElement,offset=wb.rect(container);if(currPos.top<offset.top)container.scrollTop-=Math.min(container.scrollTop,offset.top-currPos.top);else if(currPos.bottom>offset.bottom){var maxVerticalScroll=container.scrollHeight-offset.height-container.scrollTop;container.scrollTop+=Math.min(maxVerticalScroll,currPos.bottom-offset.bottom)}if(currPos.left<offset.left)container.scrollLeft-=Math.min(container.scrollLeft,offset.left-currPos.left);else if(currPos.right>offset.right){var maxHorizontalScroll=container.scrollWidth-offset.width-container.scrollLeft;console.log("maxHorizontalScroll: %s",maxHorizontalScroll),container.scrollLeft+=Math.min(maxHorizontalScroll,currPos.right-offset.right)}}return currentPosition=nextPosition,!1}function endDrag(){return clearTimeout(timer),timer=null,dragging?(handleDrop(),reset(),!1):void 0}function handleDrop(){dragTarget.classList.remove("dragActive"),dragTarget.classList.remove("dragIndication"),potentialDropTargets.forEach(function(elem){elem.classList.remove("dropTarget")}),wb.overlap(dragTarget,blockMenu)?(Event.trigger(dragTarget,"wb-delete"),dragTarget.parentElement.removeChild(dragTarget)):dropTarget?(dropTarget.classList.remove("dropActive"),wb.matches(dragTarget,".step")?(dropTarget.insertBefore(dragTarget,dropCursor()),dragTarget.removeAttribute("style"),Event.trigger(dragTarget,"wb-add")):(dropTarget.appendChild(dragTarget),dragTarget.removeAttribute("style"),Event.trigger(dragTarget,"wb-add"))):cloned?dragTarget.parentElement.removeChild(dragTarget):startParent?(wb.matches(startParent,".socket"),startParent.appendChild(dragTarget),dragTarget.removeAttribute("style"),startParent=null):(workspace.appendChild(dragTarget),wb.reposition(dragTarget,startPosition))}function positionExpressionDropCursor(){if(!potentialDropTargets.length)return console.log("no drop targets found"),void 0;var targets=potentialDropTargets.map(function(target){return[wb.overlap(dragTarget,target),target]});targets.sort().reverse(),dropTarget&&dropTarget.classList.remove("dropActive"),dropTarget=targets[0][1],dropTarget.classList.add("dropActive")}function positionDropCursor(){var dragRect=wb.rect(wb.findChild(dragTarget,".label")),cy=dragRect.top+dragRect.height/2,overlapping=potentialDropTargets.filter(function(item){var r=wb.rect(item);return cy<r.top?!1:cy>r.bottom?!1:!0});if(overlapping.sort(function(a,b){return wb.rect(b).left-wb.rect(a).left}),!overlapping.length)return workspace.appendChild(dropCursor()),dropTarget=workspace,void 0;dropTarget=overlapping[0];var position,middle,siblings=wb.findChildren(dropTarget,".step");if(!siblings.length)return dropTarget.appendChild(dropCursor()),void 0;for(var sIdx=0;sIdx<siblings.length;sIdx++){var sibling=siblings[sIdx];if(position=wb.rect(sibling),!(cy<position.top-4||cy>position.bottom+4))return middle=position.top+position.height/2,middle>cy?(dropTarget.insertBefore(dropCursor(),sibling),void 0):(dropTarget.insertBefore(dropCursor(),sibling.nextSibling),void 0)}dropTarget.appendChild(dropCursor())}function hitTest(){dragTarget&&(wb.matches(dragTarget,".expression")?positionExpressionDropCursor():positionDropCursor(),setTimeout(hitTest,dragTimeout))}function expressionDropTypes(expressionType){switch(expressionType){case"number":return[".number",".int",".float",".any"];case"int":return[".number",".int",".float",".any"];case"float":return[".number",".float",".any"];case"any":return[];default:return["."+expressionType,".any"]}}function hasChildBlock(elem){return!wb.findChild(elem,".block")}function getPotentialDropTargets(view){workspace||(workspace=document.querySelector(".scripts_workspace").querySelector(".contained"));var blocktype=view.dataset.blocktype;switch(blocktype){case"step":case"context":return scope?wb.findAll(scope,".contained"):wb.findAll(workspace,".contained").concat([workspace]);case"asset":case"expression":var selector=expressionDropTypes(view.dataset.type).map(dataSelector).join(",");return selector&&selector.length||(selector=".socket > .holder"),scope?wb.findAll(scope,selector).filter(hasChildBlock):wb.findAll(workspace,selector).filter(hasChildBlock);case"eventhandler":return[workspace];default:throw new Error("Unrecognized blocktype: "+blocktype)}}function dataSelector(name){return"."===name[0]&&(name=name.slice(1)),".socket[data-type="+name+"] > .holder"}var startParent,startIndex,timer,dragTarget,dropTarget,dragging,currentPosition,scope,workspace,potentialDropTargets,_dropCursor,dragTimeout=20,blockMenu=document.querySelector("#block_menu");reset(),wb.initializeDragHandlers=function(){Event.isTouch?(Event.on(".scripts_workspace .contained, .block-menu","touchstart",".block",initDrag),Event.on(".content","touchmove",null,drag),Event.on(".content","touchend",null,endDrag)):(Event.on(".scripts_workspace .contained, .block-menu","mousedown",".block",initDrag),Event.on(".content","mousemove",null,drag),Event.on(".content","mouseup",null,endDrag))}}(this);var UUID_TEST=/[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}/;switch(function(wb){function removeBlock(event){event.stopPropagation(),wb.matches(event.wbTarget,".expression")?removeExpression(event):removeStep(event)}function addBlock(event){event.stopPropagation(),wb.matches(event.wbTarget,".expression")?addExpression(event):addStep(event)}function removeStep(event){var block=event.wbTarget;if(block.classList.contains("step")&&!block.classList.contains("context")){var parent=wb.closest(block,".context");if(block.dataset.locals&&block.dataset.locals.length){var locals=wb.findAll(parent,'[data-local-source="'+block.id+'"]');locals.forEach(function(local){local.isTemplateBlock||Event.trigger(local,"wb-remove"),local.parentElement.removeChild(local)}),delete block.dataset.localsAdded}}}function removeExpression(event){var block=event.wbTarget;wb.findChildren(block.parentElement,"input, select").forEach(function(elem){elem.removeAttribute("style")})}function addStep(event){var block=event.wbTarget;if(block.dataset.locals&&block.dataset.locals.length&&!block.dataset.localsAdded){var parent=wb.closest(block,".context"),locals=wb.findChild(parent,".locals"),parsedLocals=[];JSON.parse(block.dataset.locals).forEach(function(spec){spec.isTemplateBlock=!0,spec.isLocal=!0,spec.group=block.dataset.group,spec.seqNum||(spec.seqNum=block.dataset.seqNum),spec.scopeId=parent.id,spec.id||(spec.id=spec.scriptId=uuid()),spec.localSource=block.id,block.dataset.localsAdded=!0,locals.appendChild(Block(spec)),parsedLocals.push(spec)}),block.dataset.locals=JSON.stringify(parsedLocals)}}function addExpression(event){var block=event.wbTarget;wb.findChildren(block.parentElement,"input, select").forEach(function(elem){elem.style.display="none"}),event.stopPropagation&&event.stopPropagation()}function onClone(event){event.wbTarget}function socketDesc(socket){var desc={name:socket.dataset.name};socket.dataset.type&&(desc.type=socket.dataset.type),socket.dataset.value&&(desc.value=socket.dataset.value),socket.dataset.options&&(desc.options=socket.dataset.options),socket.dataset.block&&(desc.block=socket.dataset.block);var uName=wb.findChild(socket,".name").textContent;wb.findChild(socket,".name"),desc.name!==uName&&(desc.uName=uName);var holder=wb.findChild(socket,".holder");if(holder){var input=wb.findChild(holder,"input, select");desc.uValue=input.value,wb.findChild(holder,".block"),wb.matches(holder.lastElementChild,".block")&&(desc.uBlock=blockDesc(holder.lastElementChild))}return desc}function blockDesc(block){var label=wb.findChild(block,".label"),sockets=wb.findChildren(label,".socket"),desc={blocktype:block.dataset.blocktype,group:block.dataset.group,id:block.id,help:block.title,scopeId:block.dataset.scopeId,scriptId:block.dataset.scriptId,sockets:sockets.map(socketDesc)};block.dataset.seqNum&&(desc.seqNum=block.dataset.seqNum),block.dataset.script&&(desc.script=block.dataset.script),block.dataset.isTemplateBlock&&(desc.isTemplateBlock=!0),block.dataset.isLocal&&(desc.isLocal=!0),block.dataset.localSource&&(desc.localSource=block.dataset.localSource),block.dataset.type&&(desc.type=block.dataset.type),block.dataset.locals&&(desc.locals=JSON.parse(block.dataset.locals)),block.dataset.closed&&(desc.closed=!0);var contained=wb.findChild(block,".contained");return contained&&contained.children.length&&(desc.contained=wb.findChildren(contained,".block").map(blockDesc)),desc}function cloneBlock(block){var blockdesc=blockDesc(block);return delete blockdesc.id,blockdesc.isLocal||delete blockdesc.seqNum,delete blockdesc.isTemplateBlock,delete blockdesc.isLocal,blockdesc.scriptId=block.id,Block(blockdesc)}function deleteBlock(event){event.wbTarget}function changeName(event){var nameSpan=event.wbTarget,input=elem("input",{value:nameSpan.textContent});nameSpan.parentNode.appendChild(input),nameSpan.style.display="none",input.focus(),input.select(),wb.resize(input),Event.on(input,"blur",null,updateName),Event.on(input,"keydown",null,maybeUpdateName)}function updateName(event){console.log("updateName on %o",event);var input=event.wbTarget;Event.off(input,"blur",updateName),Event.off(input,"keydown",maybeUpdateName);var nameSpan=input.previousSibling,newName=input.value;input.parentElement.removeChild(input),nameSpan.style.display="initial",console.log("now update all instances too");var source=wb.closest(nameSpan,".block"),instances=wb.findAll(wb.closest(source,".context"),'[data-local-source="'+source.dataset.localSource+'"]');instances.forEach(function(elem){wb.find(elem,".name").textContent=newName})}function maybeUpdateName(event){var input=event.wbTarget;27===event.keyCode?(event.preventDefault(),input.value=input.previousSibling.textContent,input.blur()):(13===event.keyCode||9===event.keyCode)&&(event.preventDefault(),input.blur())}var elem=wb.elem,_nextSeqNum=0,newSeqNum=function(){return _nextSeqNum++,_nextSeqNum},registerSeqNum=function(seqNum){seqNum&&(seqNum=Math.max(parseInt(seqNum,10),_nextSeqNum))},blockRegistry={};wb.blockRegistry=blockRegistry;var registerBlock=function(blockdesc){blockdesc.seqNum?registerSeqNum(blockdesc.seqNum):blockdesc.isTemplateBlock||(blockdesc.seqNum=newSeqNum()),blockdesc.id||(blockdesc.id=uuid()),blockRegistry[blockdesc.id]=blockdesc},getHelp=function(id){return blockRegistry[id]?blockRegistry[id].help:""},getScript=function(id){try{return blockRegistry[id].script}catch(e){return console.log("Error: could not get script for %o",id),console.log("Hey look: %o",document.getElementById(id)),""}},getSockets=function(block){return wb.findChildren(wb.findChild(block,".label"),".socket")},getSocketValue=function(socket){return socketValue(wb.findChild(socket,".holder"))},createSockets=function(obj){return obj.sockets.map(function(socket_descriptor){return Socket(socket_descriptor,obj)})},Block=function(obj){registerBlock(obj);var block=elem("div",{"class":function(){var names=["block",obj.group,obj.blocktype];return"expression"===obj.blocktype?(names.push(obj.type),names.push(obj.type+"s")):"context"===obj.blocktype?names.push("step"):"eventhandler"===obj.blocktype?(names.push("step"),names.push("context")):"asset"===obj.blocktype&&names.push("expression"),names.join(" ")},"data-blocktype":obj.blocktype,"data-group":obj.group,id:obj.id,"data-scope-id":obj.scopeId||0,"data-script-id":obj.scriptId||obj.id,"data-local-source":obj.localSource||null,"data-sockets":JSON.stringify(obj.sockets),"data-locals":JSON.stringify(obj.locals),title:obj.help||getHelp(obj.scriptId||obj.id)},elem("div",{"class":"label"},createSockets(obj)));if(obj.seqNum&&(block.dataset.seqNum=obj.seqNum),obj.type&&(block.dataset.type=obj.type),obj.script&&(block.dataset.script=obj.script),obj.isLocal&&(block.dataset.isLocal=obj.isLocal),obj.isTemplateBlock&&(block.dataset.isTemplateBlock=obj.isTemplateBlock),obj.closed&&(block.dataset.closed=!0),"context"===obj.blocktype||"eventhandler"===obj.blocktype){block.appendChild(elem("div",{"class":"locals block-menu"}));var contained=elem("div",{"class":"contained"});if(block.appendChild(contained),obj.contained&&obj.contained.map(function(childdesc){var child=Block(childdesc);contained.appendChild(child),addStep({wbTarget:child})}),!wb.matches(block,".scripts_workspace")){var label=wb.findChild(block,".label");label.insertBefore(elem("div",{"class":"disclosure"}),label.firstElementChild)}}return block};Event.on(document.body,"wb-remove",".block",removeBlock),Event.on(document.body,"wb-add",".block",addBlock),Event.on(document.body,"wb-clone",".block",onClone),Event.on(document.body,"wb-delete",".block",deleteBlock);var Socket=function(desc,blockdesc){var socket=elem("div",{"class":"socket","data-name":desc.name,"data-id":blockdesc.id},elem("span",{"class":"name"},desc.uName||desc.name));if(desc.value&&(socket.dataset.value=desc.value),desc.options&&(socket.dataset.options=desc.options),socket.firstElementChild.innerHTML=socket.firstElementChild.innerHTML.replace(/##/,' <span class="seq-num">'+(blockdesc.seqNum||"##")+"</span>"),desc.type){socket.dataset.type=desc.type;var holder=elem("div",{"class":"holder"},[Default(desc)]);socket.appendChild(holder)}if(desc.block&&(socket.dataset.block=desc.block),!blockdesc.isTemplateBlock){var newBlock=null;desc.uBlock?newBlock=Block(desc.uBlock):desc.block&&(newBlock=cloneBlock(document.getElementById(desc.block))),newBlock&&(holder.appendChild(newBlock),addExpression({wbTarget:newBlock}))}return socket},Default=function(obj){var value,type=obj.type;switch(("int"===type||"float"===type)&&(type="number"),type){case"any":value=obj.uValue||obj.value||"";break;case"number":value=obj.uValue||obj.value||0;break;case"string":value=obj.uValue||obj.value||"";break;case"color":value=obj.uValue||obj.value||"#000000";break;case"date":value=obj.uValue||obj.value||(new Date).toISOString().split("T")[0];break;case"time":value=obj.uValue||obj.value||(new Date).toISOString().split("T")[1];break;case"datetime":value=obj.uValue||obj.value||(new Date).toISOString();break;case"url":value=obj.uValue||obj.value||"http://waterbearlang.com/";break;case"image":value=obj.uValue||obj.value||"";break;case"phone":value=obj.uValue||obj.value||"604-555-1212";break;case"email":value=obj.uValue||obj.value||"waterbear@waterbearlang.com";break;case"boolean":obj.options="boolean";case"choice":var choice=elem("select");return wb.choiceLists[obj.options].forEach(function(opt){var option=elem("option",{},opt),value=obj.uValue||obj.value;value&&value===opt&&option.setAttribute("selected","selected"),choice.appendChild(option)}),choice;default:value=obj.uValue||obj.value||""}var input=elem("input",{type:type,value:value});return wb.resize(input),input},socketValue=function(holder){if(holder.children.length>1)return codeFromBlock(wb.findChild(holder,".block"));var value=wb.findChild(holder,"input, select").value,type=holder.parentElement.dataset.type;return("string"===type||"choice"===type)&&('"'===value[0]&&(value=value.slice(1)),'"'===value[value.length-1]&&(value=value.slice(0,-1)),value=value.replace(/"/g,'\\"'),value='"'+value+'"'),value},codeFromBlock=function(block){function replace_values(match){var idx=parseInt(match.slice(2,-2),10)-1;return"{"===match[0]?expressionValues[idx]||"null":childValues||"/* do nothing */"}var scriptTemplate=getScript(block.dataset.scriptId).replace(/##/g,"_"+block.dataset.seqNum),childValues=[],label=wb.findChild(block,".label"),expressionValues=wb.findChildren(label,".socket").map(function(socket){return wb.findChild(socket,".holder")}).filter(function(holder){return holder}).map(socketValue);if(wb.matches(block,".context"))var childValues=wb.findChildren(wb.findChild(block,".contained"),".block").map(codeFromBlock).join("");var _code=scriptTemplate.replace(/\{\{\d\}\}/g,replace_values),_code2=_code.replace(/\[\[\d\]\]/g,replace_values);return _code2};wb.Block=Block,wb.blockDesc=blockDesc,wb.registerSeqNum=registerSeqNum,wb.cloneBlock=cloneBlock,wb.codeFromBlock=codeFromBlock,wb.addBlockHandler=addBlock,wb.changeName=changeName,wb.getSockets=getSockets,wb.getSocketValue=getSocketValue}(wb),function(wb){function tabSelect(event){var target=event.wbTarget;document.querySelector(".tabbar .selected").classList.remove("selected"),target.classList.add("selected"),wb.matches(target,".scripts_workspace_tab")?showWorkspace("block"):wb.matches(target,".scripts_text_view_tab")&&(showWorkspace("text"),updateScriptsView())}function accordion(event){var open=document.querySelector("#block_menu .open");open&&open.classList.remove("open"),open&&open===event.wbTarget.nextSibling||event.wbTarget.nextSibling.classList.add("open")}function showWorkspace(mode){var workspace=document.querySelector(".workspace");"block"===mode?(workspace.classList.remove("textview"),workspace.classList.add("blockview")):"text"===mode&&(workspace.classList.remove("blockview"),workspace.classList.add("textview"))}function updateScriptsView(){var blocks=wb.findAll(document.body,".workspace .scripts_workspace"),view=wb.find(document.body,".workspace .scripts_text_view");wb.writeScript(blocks,view)}function run_menu(title,specs){edit_menu(title,specs)}function edit_menu(title,specs){menu_built=!0;var group=title.toLowerCase().split(/\s+/).join(""),submenu=document.querySelector("."+group+"+ .submenu");if(!submenu){var header=wb.elem("h3",{"class":group+" accordion-header"},title),submenu=wb.elem("div",{"class":"submenu block-menu accordion-body"}),blockmenu=document.querySelector("#block_menu");blockmenu.appendChild(header),blockmenu.appendChild(submenu)}specs.forEach(function(spec){spec.group=group,spec.isTemplateBlock=!0,submenu.appendChild(wb.Block(spec))})}Event.on(".tabbar","click",".chrome_tab",tabSelect),Event.on("#block_menu","click",".accordion-header",accordion),wb.showWorkspace=showWorkspace,window.updateScriptsView=updateScriptsView,wb.menu=function(blockspec){var title=blockspec.name.replace(/\W/g,""),specs=blockspec.blocks;switch(wb.view){case"result":return run_menu(title,specs);case"blocks":return edit_menu(title,specs);case"editor":return edit_menu(title,specs);default:return edit_menu(title,specs)}},"result"===wb.view&&Event.once(document.body,"wb-script-loaded",null,runCurrentScripts)}(wb),function(wb){function clearScripts(event,force){if(force||confirm("Throw out the current script?")){var workspace=document.querySelector(".workspace > .scripts_workspace");workspace.parentElement.removeChild(workspace),createWorkspace("Workspace"),document.querySelector(".workspace > .scripts_text_view").innerHTML=""}}function saveCurrentScripts(){wb.showWorkspace("block"),document.querySelector("#block_menu").scrollIntoView(),localStorage["__"+language+"_current_scripts"]=scriptsToString()}function scriptsToString(title,description){title||(title=""),description||(description="");var blocks=wb.findAll(document.body,".workspace .scripts_workspace");return JSON.stringify({title:title,description:description,date:Date.now(),waterbearVersion:"2.0",blocks:blocks.map(wb.blockDesc)})}function createDownloadUrl(evt){window.webkitURL||window.URL;var file=new Blob([scriptsToString()],{type:"application/json"}),reader=new FileReader,a=document.createElement("a");reader.onloadend=function(){a.href=reader.result,a.download="script.json",a.target="_blank",document.body.appendChild(a),a.click()},reader.readAsDataURL(file),evt.preventDefault()}function loadScriptsFromFilesystem(){var input=document.createElement("input");input.setAttribute("type","file"),input.setAttribute("accept","application/json"),input.addEventListener("change",function(){var file=input.files[0];loadScriptsFromFile(file)}),input.click()}function loadScriptsFromObject(fileObject){if(!fileObject)return createWorkspace();var blocks=fileObject.blocks.map(wb.Block);return blocks.length?(blocks.length>1&&(console.log("not really expecting multiple blocks here right now"),console.log(blocks)),blocks.forEach(function(block){wireUpWorkspace(block),Event.trigger(block,"wb-add")}),wb.loaded=!0,Event.trigger(document.body,"wb-script-loaded"),void 0):createWorkspace()}function loadScriptsFromGist(gist){var file,keys=Object.keys(gist.data.files);return keys.forEach(function(key){/.*\.json/.test(key)&&(file=gist.data.files[key].content)}),file?(loadScriptsFromObject(JSON.parse(file)),void 0):(console.log("no json file found in gist: %o",gist),void 0)}function runScriptFromGist(gist){console.log("running script from gist");var file,keys=Object.keys(gist.data.files);return keys.forEach(function(key){/.*\.js$/.test(key)&&(console.log("found javascript file: %s",key),file=gist.data.files[key].content)}),file?(wb.runScript(file),void 0):(console.log("no javascript file found in gist: %o",gist),void 0)}function createWorkspace(name){var id=uuid(),workspace=wb.Block({group:"scripts_workspace",id:id,scriptId:id,scopeId:id,blocktype:"context",sockets:[{name:name}],script:"[[1]]",isTemplateBlock:!1,help:"Drag your script blocks here"});wireUpWorkspace(workspace)}function wireUpWorkspace(workspace){workspace.addEventListener("drop",getFiles,!1),workspace.addEventListener("dragover",function(evt){evt.preventDefault()},!1),wb.findAll(document,".scripts_workspace").forEach(function(ws){ws.parentElement.removeChild(ws)}),document.querySelector(".workspace").appendChild(workspace),workspace.querySelector(".contained").appendChild(wb.elem("div",{"class":"dropCursor"})),wb.initializeDragHandlers()}function loadScriptsFromFile(file){if(-1!==file.type.indexOf("json")){var reader=new FileReader;reader.readAsText(file),reader.onload=function(evt){clearScripts(null,!0);var saved=JSON.parse(evt.target.result);loadScriptsFromObject(saved)}}}function getFiles(evt){evt.stopPropagation(),evt.preventDefault();var files=evt.dataTransfer.files;if(files.length>0){var file=files[0];loadScriptsFromFile(file)}}var language=location.pathname.match(/\/(.*)\.html/)[1];Event.on(".clearScripts","click",null,clearScripts),Event.on(".editScript","click",null,function(){document.body.className="editor",wb.loadCurrentScripts(wb.queryParams)}),Event.on(".goto_stage","click",null,function(){document.body.className="result"}),window.onunload=saveCurrentScripts,Event.on(".save_scripts","click",null,createDownloadUrl),Event.on(".restore_scripts","click",null,loadScriptsFromFilesystem),wb.loaded=!1,wb.loadCurrentScripts=function(queryParsed){if(!wb.loaded){if(queryParsed.gist)wb.jsonp("https://api.github.com/gists/"+queryParsed.gist,loadScriptsFromGist);else if(localStorage["__"+language+"_current_scripts"]){var fileObject=JSON.parse(localStorage["__"+language+"_current_scripts"]);
fileObject&&loadScriptsFromObject(fileObject)}else createWorkspace("Workspace");wb.loaded=!0}Event.trigger(document.body,"wb-loaded")},wb.runCurrentScripts=function(queryParsed){if(queryParsed.gist)wp.json("https://api.github.com/gists/"+queryParsed.gist,runScriptFromGist);else if(localStorage["__"+language+"_current_scripts"]){var fileObject=localStorage["__"+language+"_current_scripts"];fileObject&&wb.runScript(fileObject)}},wb.createWorkspace=createWorkspace,Event.on(".workspace","click",".disclosure",function(evt){var block=wb.closest(evt.wbTarget,".block");block.dataset.closed?delete block.dataset.closed:block.dataset.closed=!0}),Event.on(".workspace","dblclick",".locals .name",wb.changeName),Event.on(".workspace","keypress","input",wb.resize),Event.on(document.body,"wb-loaded",null,function(){console.log("loaded")}),Event.on(document.body,"wb-script-loaded",null,function(){console.log("script loaded")})}(wb),function(){function clearScriptsDefault(event,force){clearScripts(event,force),loadDefaultScript()}window.choiceLists={"boolean":["true","false"],highlow:["HIGH","LOW"],inoutput:["INPUT","OUTPUT"],onoff:["ON","OFF"],logic:["true","false"],digitalpins:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,"A0","A1","A2","A3","A4","A5"],analoginpins:["A0","A1","A2","A3","A4","A5"],pwmpins:[3,5,6,9,10,11],baud:[9600,300,1200,2400,4800,14400,19200,28800,38400,57600,115200],analogrefs:["DEFAULT","INTERNAL","INTERNAL1V1","INTERNAL2V56","EXTERNAL"]},window.setDefaultScript=function(script){window.defaultscript=script},window.loadDefaultScript=function(){"undefined"!=typeof window.defaultscript&&loadScriptsFromObject(window.defaultscript)},wb.writeScript=function(elements,view){var code=elements.map(function(elem){return wb.codeFromBlock(elem)}).join("\n");view.innerHTML='<pre class="language-arduino">'+code+"</pre>"},jQuery.fn.extend({wrapScript:function(){var script=this.map(function(){return wb.Block.model(this).code()}).get().join("\n\n");return script},writeScript:function(view){view.html('<code><pre class="script_view">'+this.wrapScript()+"</pre></code>")}}),$(".clearScripts").click(clearScriptsDefault);var defaultscript=[{klass:"control",label:"Global Settings",script:"/*Global Settings*/\n\n[[next]]\n\n",containers:0,trigger:!0,sockets:[],contained:[],next:""},{klass:"control",label:"Setup - When program starts",script:"void setup()\n{\n[[next]]\n}\n",containers:0,trigger:!0,sockets:[],contained:[],next:""},{klass:"control",label:"Main loop",script:"void loop()\n{\n[[1]]\n}\n",containers:1,trigger:!0,sockets:[],contained:[""],next:""}];setDefaultScript(defaultscript)}(),wb.menu({name:"Boolean",blocks:[{blocktype:"expression",id:"03d1df81-c7de-40a0-a88f-95b732d19936",type:"boolean",script:"({{1}} && {{2}})",help:"Check if both are true",sockets:[{name:"",type:"boolean",value:null},{name:"and",type:"boolean",value:null}]},{blocktype:"expression",id:"482db566-b14b-4381-8135-1e29f8c4e7c3",type:"boolean",script:"({{1}} || {{2}})",help:"Check if one is true",sockets:[{name:"",type:"boolean",value:null},{name:"or",type:"boolean",value:null}]},{blocktype:"expression",id:"866a1181-e0ff-4ebc-88dd-55e2b70d7c52",type:"boolean",script:"(! {{1}})",help:"Not true is false and Not false is true",sockets:[{name:"not",type:"boolean",value:null}]}]}),wb.menu({name:"Controls",blocks:[{blocktype:"eventhandler",id:"25339ea4-1bc2-4c66-bde8-c455b9a3d1cd",script:"void setup()\n{\n[[1]]\n}\n",help:"Start scripts when program starts",sockets:[{name:"Setup - When program starts"}]},{blocktype:"eventhandler",id:"fb958a3d-0372-4ab7-95c1-70dd9c454d19",script:"void loop()\n{\n[[1]]\n}\n",help:"Trigger for main loop",sockets:[{name:"Main loop"}]},{blocktype:"eventhandler",id:"1e4b61cf-c4ce-4b08-9944-7ea1ebf54775",script:"/*Global Settings*/\n\n[[1]]\n\n",help:"Trigger for blocks in global setup",sockets:[{name:"Global Settings"}]},{blocktype:"step",id:"b54a3daa-3dfa-4885-afc4-9592944296df",script:"{{1}}();",help:"Send a message to all listeners",sockets:[{name:"broadcast",type:"string",value:"ack"},{name:"message"}]},{blocktype:"eventhandler",id:"64fd2a90-a689-4ffd-bd66-bc8c61775cd4",script:"function {{1}}(){\n[[next]]\n}",help:"Trigger for blocks to run when message is received",sockets:[{name:"when I receive",type:"string",value:"ack"},{name:"message"}]},{blocktype:"context",id:"c79f205e-eab3-4ebd-9c72-2e6a54209593",script:"while({{1}}){\n[[1]]\n}",help:"loop until condition fails",sockets:[{name:"forever if",type:"boolean",value:"false"}]},{blocktype:"context",id:"0a313a7a-1187-4619-9819-fbfd7a32f6a6",script:"if({{1}}){\n[[1]]\n}",help:"only run blocks if condition is true",sockets:[{name:"if",type:"boolean",value:null}]},{blocktype:"context",id:"dc724c8c-27b3-4c93-9420-050dd2466c43",script:"if(! {{1}} ){\n[[1]]\n}",help:"run blocks if condition is not true",sockets:[{name:"if not",type:"boolean",value:null}]},{blocktype:"context",id:"a11f426a-9a48-4e0f-83f5-cff4ec5b4154",script:"while(!({{1}})){\n[[1]]\n}",help:"loop until condition is true",sockets:[{name:"repeat until",type:"boolean",value:null}]}]}),wb.menu({name:"Digital I/O",blocks:[{blocktype:"step",id:"451eda35-be10-498f-a714-4a32f3bcbe53",script:'digital_output## = "{{1}}"; pinMode(digital_output##, OUTPUT);',help:"Create a named pin set to output",locals:[{blocktype:"expression",sockets:[{name:"digital_output##"}],script:"digital_output##",type:"string"}],sockets:[{name:"Create digital_output## on Pin",type:"choice",options:"digitalpins",value:"choice"}]},{blocktype:"step",id:"d0a3d825-0d2d-4339-838f-b30d06441c23",script:"if({{2}} == HIGH)\n{\ndigitalWrite({{1}}, HIGH);\n}\nelse\n{\ndigitalWrite({{1}}, LOW);\n}\n",help:"Write a boolean value to given pin",sockets:[{name:"Digital Pin",type:"string",value:null},{name:"ON if",type:"boolean",value:null}]},{blocktype:"step",id:"ef757ca5-053d-4cfd-8ed4-9345cefef569",script:'digital_input## = "{{1}}"; pinMode(digital_input##, INPUT);',help:"Create a named pin set to input",locals:[{blocktype:"expression",sockets:[{name:"digital_input##"}],script:"digital_input##",type:"string"}],sockets:[{name:"Create digital_input## on Pin",type:"choice",options:"digitalpins",value:"choice"}]},{blocktype:"expression",id:"010020b8-4e76-4e56-9cd5-65541bf2dbc9",type:"boolean",script:"(digitalRead({{1}}) == HIGH)",help:"Is the digital input pin ON",sockets:[{name:"Digital Pin",type:"string",value:null}]},{blocktype:"step",id:"220caace-bd77-4e82-9f5d-0457a5bbfe9f",script:'analog_input## = "{{1}}"; pinMode(analog_input##, INPUT);',help:"Create a named pin set to input",locals:[{blocktype:"expression",sockets:[{name:"analog_input##"}],script:"analog_input##",type:"string"}],sockets:[{name:"Create analog_input## on Pin",type:"choice",options:"analoginpins",value:"choice"}]},{blocktype:"expression",id:"5b76796a-7fa9-4d56-b532-5194bf5db20f",type:"int",script:"(analogRead({{1}}))",help:"Value of analog pin",sockets:[{name:"Analog Pin",type:"string",value:null}]},{blocktype:"step",id:"4fa77d69-30fb-4734-8697-5ed56ba67433",script:'analog_output## = "{{1}}"; pinMode(analog_output##, OUTPUT);',help:"Create a named pin set to output",locals:[{blocktype:"expression",sockets:[{name:"analog_output##"}],script:"analog_output##",type:"string"}],sockets:[{name:"Create analog_output## on Pin",type:"choice",options:"pwmpins",value:"choice"}]},{blocktype:"step",id:"4b29af90-96e0-4de9-a7d8-2c88a35e1f49",script:"analogWrite({{1}}, {{2}});",help:"Set value of a pwm pin",sockets:[{name:"Analog",type:"string",value:null},{name:"outputs",type:"int",value:"255"}]}]}),wb.menu({name:"Math",blocks:[{blocktype:"expression",id:"cbb65aa7-b36c-4311-a479-f1776579dcd3",type:"number",script:"({{1}} + {{2}})",help:"Add two numbers",sockets:[{name:"",type:"number",value:"0"},{name:"+",type:"number",value:"0"}]},{blocktype:"expression",id:"594700d5-64c6-4b21-bc70-f3fbf6913a69",type:"number",script:"({{1}} - {{2}})",help:"Subtract two numbers",sockets:[{name:"",type:"number",value:"0"},{name:"-",type:"number",value:"0"}]},{blocktype:"expression",id:"afec758c-7ccc-4ee5-8d2c-f95160da83d4",type:"number",script:"({{1}} * {{2}})",help:"Multiply two numbers",sockets:[{name:"",type:"number",value:"0"},{name:"*",type:"number",value:"0"}]},{blocktype:"expression",id:"5cec08b8-eb58-4ef0-a73e-f5245d6859a2",type:"number",script:"({{1}} / {{2}})",help:"Divide two numbers",sockets:[{name:"",type:"number",value:"0"},{name:"/",type:"number",value:"0"}]},{blocktype:"expression",id:"90a5d524-fa8a-4a52-a4df-0beb83d32c40",type:"number",script:"(random({{1}}, {{2}}))",help:"Generate a random number between two other numbers",sockets:[{name:"pick random",type:"number",value:"1"},{name:"to",type:"number",value:"10"}]},{blocktype:"step",id:"d35330ee-5b49-492b-b7dd-41c3fd1496d0",script:"(randomSeed({{1}}))",help:"",sockets:[{name:"set seed for random numbers to",type:"number",value:"1"}]},{blocktype:"expression",id:"7f047e8a-3a87-49f8-b9c7-daad742faa9d",type:"boolean",script:"({{1}} < {{2}})",help:"Check if one number is less than another",sockets:[{name:"",type:"number",value:"0"},{name:"<",type:"number",value:"0"}]},{blocktype:"expression",id:"faddd68c-6c75-4908-9ee6-bccc246f9d89",type:"boolean",script:"({{1}} == {{2}})",help:"Check if one number is equal to another",sockets:[{name:"",type:"number",value:"0"},{name:"=",type:"number",value:"0"}]},{blocktype:"expression",id:"e4d81ccd-f9dc-4a0b-b41f-a5cd146a8c27",type:"boolean",script:"({{1}} > {{2}})",help:"Check if one number is greater than another",sockets:[{name:"",type:"number",value:"0"},{name:">",type:"number",value:"0"}]},{blocktype:"expression",id:"8353c1f3-a1da-4d80-9bf9-0c9584c3896b",type:"number",script:"({{1}} % {{2}})",help:"Gives the remainder from the division of these two number",sockets:[{name:"",type:"number",value:"0"},{name:"mod",type:"number",value:"0"}]},{blocktype:"expression",id:"1fde8b93-1306-4908-97c8-d628dd91eb4f",type:"int",script:"(int({{1}}))",help:"Gives the whole number, without the decimal part",sockets:[{name:"round",type:"number",value:"0"}]},{blocktype:"expression",id:"b7634de4-69ed-492c-bc9a-16ac3bb5ca45",type:"number",script:"(abs({{1}}))",help:"Gives the positive of the number",sockets:[{name:"absolute of",type:"number",value:"10"}]},{blocktype:"expression",id:"20268318-b168-4519-a32a-10b94c264226",type:"float",script:"(cos((180 / {{1}})/ 3.14159))",help:"Gives the cosine of the angle",sockets:[{name:"cosine of",type:"number",value:"10"},{name:"degrees"}]},{blocktype:"expression",id:"86c2f303-861f-4ad7-a7de-3108637ce264",type:"float",script:"(sin((180 / {{1}})/ 3.14159))",help:"Gives the sine of the angle",sockets:[{name:"sine of",type:"number",value:"10"},{name:"degrees"}]},{blocktype:"expression",id:"0e018648-0b45-4096-9052-e3080a47793a",type:"float",script:"(tan((180 / {{1}})/ 3.14159))",help:"Gives the tangent of the angle given",sockets:[{name:"tangent of",type:"number",value:"10"},{name:"degrees"}]},{blocktype:"expression",id:"814444c5-f3f4-4412-975c-7284409f1f3d",type:"number",script:"(pow({{1}}, {{2}}))",help:"Gives the first number multiplied by itself the second number of times",sockets:[{name:"",type:"number",value:"10"},{name:"to the power of",type:"number",value:"2"}]},{blocktype:"expression",id:"1f4df24e-22ea-460e-87c5-4b0f92e233ce",type:"float",script:"(sqrt({{1}}))",help:"Gives the two numbers that if multiplied will be equal to the number input",sockets:[{name:"square root of",type:"number",value:"10"}]},{blocktype:"expression",id:"18a0560d-beff-43da-8708-55398cc08d30",type:"string",script:"{{1}}",help:"Allows you to use a numeric result as a string",sockets:[{name:"",type:"number",value:"10"},{name:"as string"}]},{blocktype:"expression",id:"e37dae6d-608f-43e9-9cd9-57ff03aba29d",type:"number",script:"map({{1}}, 0, 1023, 0, 255)",help:"",sockets:[{name:"Map",type:"number",value:null},{name:"from Analog in to Analog out"}]},{blocktype:"expression",id:"007bccc5-36b2-4ff8-a0bc-f80def66ff49",type:"number",script:"map({{1}}, 0, 1023, 0, 255)",help:"",sockets:[{name:"Map",type:"number",value:null},{name:"from",type:"number",value:"0]-[number"},{name:"to",type:"number",value:"0]-[number"}]}]}),wb.menu({name:"Serial I/O",blocks:[{blocktype:"step",id:"11c7b422-0549-403e-9f2e-e1db13964f1b",script:"Serial.begin({{1}});",help:"Eanble serial communications at a chosen speed",sockets:[{name:"Setup serial communication at",type:"choice",options:"baud",value:"choice"}]},{blocktype:"step",id:"9ffc70c4-b0da-4d2c-a38a-f1ec2ec743ac",script:"Serial.println({{1}});",help:"Send a message over the serial connection followed by a line return",sockets:[{name:"Send",type:"any",value:"Message"},{name:"as a line"}]},{blocktype:"step",id:"40fb939a-a393-4d26-8902-93ee78bd01b0",script:"Serial.print({{1}});",help:"Send a message over the serial connection",sockets:[{name:"Send",type:"any",value:"Message"}]},{blocktype:"expression",id:"a1630959-fc16-4ba8-af98-4724edc636b4",type:"string",script:"Serial.read()",help:"Read a message from the serial connection",sockets:[{name:"Message Value"}]},{blocktype:"step",id:"43618563-c8a3-4330-bfef-89469a797a90",script:"Serial.end();",help:"Disable serial communications",sockets:[{name:"End serial communication"}]}]}),wb.menu({name:"Timing",blocks:[{blocktype:"step",id:"5f4a98ff-3a12-4f2d-8327-7c6a375c0192",script:"delay(1000*{{1}});",help:"pause before running subsequent blocks",sockets:[{name:"wait",type:"int",value:"1"},{name:"secs"}]},{blocktype:"expression",id:"937921ed-49f4-4915-ba39-be217ddb6175",type:"int",script:"(millis())",help:"int value of time elapsed",sockets:[{name:"Milliseconds since program started"}]},{blocktype:"expression",id:"7d4ab88b-7769-497a-8822-8f0cc92c81de",type:"int",script:"(int(millis()/1000))",help:"int value of time elapsed",sockets:[{name:"Seconds since program started"}]}]}),wb.menu({name:"Variables",blocks:[{blocktype:"step",id:"eda33e3e-c6de-4f62-b070-f5035737a241",script:"String {{1}} = '{{2}}';",help:"Create a string variable",sockets:[{name:"Create",type:"string",value:"var"},{name:"set to",type:"string",value:null}]},{blocktype:"step",id:"3423bd33-6a55-4660-ba78-2304308b653d",script:"{{1}} = '{{2}}';",help:"Change the value of an already created string variable",sockets:[{name:"",type:"string",value:"var"},{name:"=",type:"string",value:null}]},{blocktype:"expression",id:"076b71fc-23eb-485a-8002-7e84abe8b6cf",type:"string",script:"{{1}}",help:"Get the value of a string variable",sockets:[{name:"value of",type:"string",value:"var"}]},{blocktype:"step",id:"1236184b-2397-44b3-8c69-0b184e24ffd8",script:"int {{1}} = {{2}}'",help:"Create an integer variable",sockets:[{name:"Create",type:"string",value:"var"},{name:"set to",type:"int",value:"0"}]},{blocktype:"step",id:"60a81c46-fd2e-4eb4-a828-00d201534baa",script:"{{1}} = {{2}};",help:"Change the value of an already created integer variable",sockets:[{name:"",type:"string",value:"var"},{name:"=",type:"int",value:"0"}]},{blocktype:"expression",id:"06a44aae-31a8-4909-80b9-61151dc2d666",type:"int",script:"{{1}}",help:"Get the value of an integer variable",sockets:[{name:"value of",type:"string",value:"var"}]},{blocktype:"step",id:"645f8dde-a050-4106-b436-57c9f2301b17",script:"float {{1}} = {{2}}",help:"Create a decimal variable",sockets:[{name:"Create",type:"string",value:"var"},{name:"set to",type:"float",value:"0.0"}]},{blocktype:"step",id:"f487db77-3f81-47ae-8fb5-478e24019c0b",script:"{{1}} = {{2}};",help:"Change the value of an already created deciaml variable",sockets:[{name:"",type:"string",value:"var"},{name:"=",type:"float",value:"0.0"}]},{blocktype:"expression",id:"705a5ef3-c0b9-49f5-885d-f195c2f4c464",type:"float",script:"{{1}}",help:"Get the value of a decimal variable",sockets:[{name:"value of",type:"string",value:"var"}]},{blocktype:"step",id:"c4ab9c5d-4493-429c-beb1-be9b411c0a7e",script:"int {{1}} = {{2}};",help:"Create a new true or false variable",sockets:[{name:"Create",type:"string",value:"var"},{name:"set to",type:"boolean",value:"false"}]},{blocktype:"step",id:"027bbe7b-6b50-4d94-b447-9bca02ec513f",script:"{{1}} = {{2}};",help:"Change the value of an already created true or false variable",sockets:[{name:"",type:"string",value:"var"},{name:"=",type:"boolean",value:"false"}]},{blocktype:"expression",id:"a41881a2-7cce-4ee5-98f4-c8067e3d57a6",type:"boolean",script:"{{1}}",help:"Get the value of a true or false variable",sockets:[{name:"value of",type:"string",value:"var"}]}]}),wb.view){case"editor":case"blocks":case"result":switchMode(wb.view);break;default:switchMode("editor")}